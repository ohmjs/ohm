!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.ohm=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){var ohm=_dereq_("..");module.exports=ohm.makeRecipe(function(){return new this.newGrammar("BuiltInRules").define("alnum",[],this.alt(this.app("letter"),this.app("digit")),"an alpha-numeric character").define("letter",[],this.alt(this.app("lower"),this.app("upper")),"a letter").define("lower",[],this.range("a","z"),"a lower-case letter").define("upper",[],this.range("A","Z"),"an upper-case letter").define("digit",[],this.range("0","9"),"a digit").define("hexDigit",[],this.alt(this.app("digit"),this.range("a","f"),this.range("A","F")),"a hexadecimal digit").define("ListOf_some",["elem","sep"],this.seq(this.param(0),this.star(this.seq(this.param(1),this.param(0))))).define("ListOf_none",["elem","sep"],this.seq()).define("ListOf",["elem","sep"],this.alt(this.app("ListOf_some",[this.app("elem"),this.app("sep")]),this.app("ListOf_none",[this.app("elem"),this.app("sep")]))).define("listOf_some",["elem","sep"],this.seq(this.param(0),this.star(this.seq(this.param(1),this.param(0))))).define("listOf_none",["elem","sep"],this.seq()).define("listOf",["elem","sep"],this.alt(this.app("listOf_some",[this.app("elem"),this.app("sep")]),this.app("listOf_none",[this.app("elem"),this.app("sep")]))).build()})},{"..":28}],2:[function(_dereq_,module,exports){var ohm=_dereq_("..");module.exports=ohm.makeRecipe(function(){return new this.newGrammar("Ohm").withDefaultStartRule("Grammars").define("Grammars",[],this.star(this.app("Grammar"))).define("Grammar",[],this.seq(this.app("ident"),this.opt(this.app("SuperGrammar")),this.prim("{"),this.star(this.app("Rule")),this.prim("}"))).define("SuperGrammar",[],this.seq(this.prim("<:"),this.app("ident"))).define("Rule_define",[],this.seq(this.app("ident"),this.opt(this.app("Formals")),this.opt(this.app("ruleDescr")),this.prim("="),this.app("Alt"))).define("Rule_override",[],this.seq(this.app("ident"),this.opt(this.app("Formals")),this.prim(":="),this.app("Alt"))).define("Rule_extend",[],this.seq(this.app("ident"),this.opt(this.app("Formals")),this.prim("+="),this.app("Alt"))).define("Rule",[],this.alt(this.app("Rule_define"),this.app("Rule_override"),this.app("Rule_extend"))).define("Formals",[],this.seq(this.prim("<"),this.app("ListOf",[this.app("ident"),this.prim(",")]),this.prim(">"))).define("Params",[],this.seq(this.prim("<"),this.app("ListOf",[this.app("Seq"),this.prim(",")]),this.prim(">"))).define("Alt",[],this.seq(this.app("Term"),this.star(this.seq(this.prim("|"),this.app("Term"))))).define("Term_inline",[],this.seq(this.app("Seq"),this.app("caseName"))).define("Term",[],this.alt(this.app("Term_inline"),this.app("Seq"))).define("Seq",[],this.star(this.app("Iter"))).define("Iter_star",[],this.seq(this.app("Pred"),this.prim("*"))).define("Iter_plus",[],this.seq(this.app("Pred"),this.prim("+"))).define("Iter_opt",[],this.seq(this.app("Pred"),this.prim("?"))).define("Iter",[],this.alt(this.app("Iter_star"),this.app("Iter_plus"),this.app("Iter_opt"),this.app("Pred"))).define("Pred_not",[],this.seq(this.prim("~"),this.app("Lex"))).define("Pred_lookahead",[],this.seq(this.prim("&"),this.app("Lex"))).define("Pred",[],this.alt(this.app("Pred_not"),this.app("Pred_lookahead"),this.app("Lex"))).define("Lex_lex",[],this.seq(this.prim("#"),this.app("Base"))).define("Lex",[],this.alt(this.app("Lex_lex"),this.app("Base"))).define("Base_application",[],this.seq(this.app("ident"),this.opt(this.app("Params")),this.not(this.alt(this.seq(this.opt(this.app("ruleDescr")),this.prim("=")),this.prim(":="),this.prim("+="))))).define("Base_range",[],this.seq(this.app("Prim"),this.prim(".."),this.app("Prim"))).define("Base_prim",[],this.app("Prim")).define("Base_paren",[],this.seq(this.prim("("),this.app("Alt"),this.prim(")"))).define("Base_arr",[],this.seq(this.prim("["),this.app("Alt"),this.prim("]"))).define("Base_str",[],this.seq(this.prim("``"),this.app("Alt"),this.prim("''"))).define("Base_obj",[],this.seq(this.prim("{"),this.opt(this.prim("...")),this.prim("}"))).define("Base_objWithProps",[],this.seq(this.prim("{"),this.app("Props"),this.opt(this.seq(this.prim(","),this.prim("..."))),this.prim("}"))).define("Base",[],this.alt(this.app("Base_application"),this.app("Base_range"),this.app("Base_prim"),this.app("Base_paren"),this.app("Base_arr"),this.app("Base_str"),this.app("Base_obj"),this.app("Base_objWithProps"))).define("Prim",[],this.alt(this.app("keyword"),this.app("string"),this.app("number"))).define("Props",[],this.seq(this.app("Prop"),this.star(this.seq(this.prim(","),this.app("Prop"))))).define("Prop",[],this.seq(this.alt(this.app("name"),this.app("string")),this.prim(":"),this.app("Alt"))).define("ruleDescr",[],this.seq(this.prim("("),this.app("ruleDescrText"),this.prim(")")),"a rule description").define("ruleDescrText",[],this.star(this.seq(this.not(this.prim(")")),this.app("_")))).define("caseName",[],this.seq(this.prim("--"),this.star(this.seq(this.not(this.prim("\n")),this.app("space"))),this.app("name"),this.star(this.seq(this.not(this.prim("\n")),this.app("space"))),this.alt(this.prim("\n"),this.la(this.prim("}"))))).define("name",[],this.seq(this.app("nameFirst"),this.star(this.app("nameRest"))),"a name").define("nameFirst",[],this.alt(this.prim("_"),this.app("letter"))).define("nameRest",[],this.alt(this.prim("_"),this.app("alnum"))).define("ident",[],this.seq(this.not(this.app("keyword")),this.app("name")),"an identifier").define("keyword_null",[],this.seq(this.prim("null"),this.not(this.app("nameRest")))).define("keyword_true",[],this.seq(this.prim("true"),this.not(this.app("nameRest")))).define("keyword_false",[],this.seq(this.prim("false"),this.not(this.app("nameRest")))).define("keyword",[],this.alt(this.app("keyword_null"),this.app("keyword_true"),this.app("keyword_false"))).define("string",[],this.seq(this.prim('"'),this.star(this.app("strChar")),this.prim('"'))).define("strChar",[],this.alt(this.app("escapeChar"),this.seq(this.not(this.prim("\\")),this.not(this.prim('"')),this.not(this.prim("\n")),this.app("_")))).define("escapeChar_backslash",[],this.prim("\\\\")).define("escapeChar_doubleQuote",[],this.prim('\\"')).define("escapeChar_singleQuote",[],this.prim("\\'")).define("escapeChar_backspace",[],this.prim("\\b")).define("escapeChar_lineFeed",[],this.prim("\\n")).define("escapeChar_carriageReturn",[],this.prim("\\r")).define("escapeChar_tab",[],this.prim("\\t")).define("escapeChar_unicodeEscape",[],this.seq(this.prim("\\u"),this.app("hexDigit"),this.app("hexDigit"),this.app("hexDigit"),this.app("hexDigit"))).define("escapeChar_hexEscape",[],this.seq(this.prim("\\x"),this.app("hexDigit"),this.app("hexDigit"))).define("escapeChar",[],this.alt(this.app("escapeChar_backslash"),this.app("escapeChar_doubleQuote"),this.app("escapeChar_singleQuote"),this.app("escapeChar_backspace"),this.app("escapeChar_lineFeed"),this.app("escapeChar_carriageReturn"),this.app("escapeChar_tab"),this.app("escapeChar_unicodeEscape"),this.app("escapeChar_hexEscape")),"an escape sequence").define("number",[],this.seq(this.opt(this.prim("-")),this.plus(this.app("digit"))),"a number").define("space_singleLine",[],this.seq(this.prim("//"),this.star(this.seq(this.not(this.prim("\n")),this.app("_"))),this.prim("\n"))).define("space_multiLine",[],this.seq(this.prim("/*"),this.star(this.seq(this.not(this.prim("*/")),this.app("_"))),this.prim("*/"))).extend("space",[],this.alt(this.alt(this.app("space_singleLine"),this.app("space_multiLine")),this.range("\x00"," ")),"a space").build()})},{"..":28}],3:[function(_dereq_,module,exports){var base64=_dereq_("base64-js");var ieee754=_dereq_("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;Buffer._useTypedArrays=function(){try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};return 42===arr.foo()&&typeof arr.subarray==="function"}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;if(encoding==="base64"&&type==="string"){subject=stringtrim(subject);while(subject.length%4!==0){subject=subject+"="}}var length;if(type==="number")length=coerce(subject);else if(type==="string")length=Buffer.byteLength(subject,encoding);else if(type==="object")length=coerce(subject.length);else throw new Error("First argument needs to be a number, array or string.");var buf;if(Buffer._useTypedArrays){buf=Buffer._augment(new Uint8Array(length))}else{buf=this;buf.length=length;buf._isBuffer=true}var i;if(Buffer._useTypedArrays&&typeof subject.byteLength==="number"){buf._set(subject)}else if(isArrayish(subject)){for(i=0;i<length;i++){if(Buffer.isBuffer(subject))buf[i]=subject.readUInt8(i);else buf[i]=subject[i]}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!Buffer._useTypedArrays&&!noZero){for(i=0;i<length;i++){buf[i]=0}}return buf}Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.isBuffer=function(b){return!!(b!==null&&b!==undefined&&b._isBuffer)};Buffer.byteLength=function(str,encoding){var ret;str=str+"";switch(encoding||"utf8"){case"hex":ret=str.length/2;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"ascii":case"binary":case"raw":ret=str.length;break;case"base64":ret=base64ToBytes(str).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=str.length*2;break;default:throw new Error("Unknown encoding")}return ret};Buffer.concat=function(list,totalLength){assert(isArray(list),"Usage: Buffer.concat(list, [totalLength])\n"+"list should be an Array.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(typeof totalLength!=="number"){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function _hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;assert(strLen%2===0,"Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);assert(!isNaN(byte),"Invalid hex string");buf[offset+i]=byte}Buffer._charsWritten=i*2;return i}function _utf8Write(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function _asciiWrite(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function _binaryWrite(buf,string,offset,length){return _asciiWrite(buf,string,offset,length)}function _base64Write(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function _utf16leWrite(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=_hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=_utf8Write(this,string,offset,length);break;case"ascii":ret=_asciiWrite(this,string,offset,length);break;case"binary":ret=_binaryWrite(this,string,offset,length);break;case"base64":ret=_base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=_utf16leWrite(this,string,offset,length);break;default:throw new Error("Unknown encoding")}return ret};Buffer.prototype.toString=function(encoding,start,end){var self=this;encoding=String(encoding||"utf8").toLowerCase();start=Number(start)||0;end=end!==undefined?Number(end):end=self.length;if(end===start)return"";var ret;switch(encoding){case"hex":ret=_hexSlice(self,start,end);break;case"utf8":case"utf-8":ret=_utf8Slice(self,start,end);break;case"ascii":ret=_asciiSlice(self,start,end);break;case"binary":ret=_binarySlice(self,start,end);break;case"base64":ret=_base64Slice(self,start,end);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=_utf16leSlice(self,start,end);break;default:throw new Error("Unknown encoding")}return ret};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;assert(end>=start,"sourceEnd < sourceStart");assert(target_start>=0&&target_start<target.length,"targetStart out of bounds");assert(start>=0&&start<source.length,"sourceStart out of bounds");assert(end>=0&&end<=source.length,"sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;var len=end-start;if(len<100||!Buffer._useTypedArrays){for(var i=0;i<len;i++)target[i+target_start]=this[i+start]}else{target._set(this.subarray(start,start+len),target_start)}};function _base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function _utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function _asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++)ret+=String.fromCharCode(buf[i]);return ret}function _binarySlice(buf,start,end){return _asciiSlice(buf,start,end)}function _hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function _utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=clamp(start,len,0);end=clamp(end,len,len);if(Buffer._useTypedArrays){return Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;var newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}return newBuf}};Buffer.prototype.get=function(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};Buffer.prototype.readUInt8=function(offset,noAssert){if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"Trying to read beyond buffer length")}if(offset>=this.length)return;return this[offset]};function _readUInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val;if(littleEndian){val=buf[offset];if(offset+1<len)val|=buf[offset+1]<<8}else{val=buf[offset]<<8;if(offset+1<len)val|=buf[offset+1]}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return _readUInt16(this,offset,true,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return _readUInt16(this,offset,false,noAssert)};function _readUInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val;if(littleEndian){if(offset+2<len)val=buf[offset+2]<<16;if(offset+1<len)val|=buf[offset+1]<<8;val|=buf[offset];if(offset+3<len)val=val+(buf[offset+3]<<24>>>0)}else{if(offset+1<len)val=buf[offset+1]<<16;if(offset+2<len)val|=buf[offset+2]<<8;if(offset+3<len)val|=buf[offset+3];val=val+(buf[offset]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return _readUInt32(this,offset,true,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return _readUInt32(this,offset,false,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"Trying to read beyond buffer length")}if(offset>=this.length)return;var neg=this[offset]&128;if(neg)return(255-this[offset]+1)*-1;else return this[offset]};function _readInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val=_readUInt16(buf,offset,littleEndian,true);var neg=val&32768;if(neg)return(65535-val+1)*-1;else return val}Buffer.prototype.readInt16LE=function(offset,noAssert){return _readInt16(this,offset,true,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return _readInt16(this,offset,false,noAssert)};function _readInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len)return;var val=_readUInt32(buf,offset,littleEndian,true);var neg=val&2147483648;if(neg)return(4294967295-val+1)*-1;else return val}Buffer.prototype.readInt32LE=function(offset,noAssert){return _readInt32(this,offset,true,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return _readInt32(this,offset,false,noAssert)};function _readFloat(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+3<buf.length,"Trying to read beyond buffer length")}return ieee754.read(buf,offset,littleEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return _readFloat(this,offset,true,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return _readFloat(this,offset,false,noAssert)};function _readDouble(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+7<buf.length,"Trying to read beyond buffer length")}return ieee754.read(buf,offset,littleEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return _readDouble(this,offset,true,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return _readDouble(this,offset,false,noAssert)};Buffer.prototype.writeUInt8=function(value,offset,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset>=this.length)return;this[offset]=value};function _writeUInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"trying to write beyond buffer length");verifuint(value,65535)}var len=buf.length;if(offset>=len)return;for(var i=0,j=Math.min(len-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){_writeUInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){_writeUInt16(this,value,offset,false,noAssert)};function _writeUInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"trying to write beyond buffer length");verifuint(value,4294967295)}var len=buf.length;if(offset>=len)return;for(var i=0,j=Math.min(len-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){_writeUInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){_writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt8=function(value,offset,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<this.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(offset>=this.length)return;if(value>=0)this.writeUInt8(value,offset,noAssert);else this.writeUInt8(255+value+1,offset,noAssert)};function _writeInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}var len=buf.length;if(offset>=len)return;if(value>=0)_writeUInt16(buf,value,offset,littleEndian,noAssert);else _writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert)}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){_writeInt16(this,value,offset,true,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){_writeInt16(this,value,offset,false,noAssert)};function _writeInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}var len=buf.length;if(offset>=len)return;if(value>=0)_writeUInt32(buf,value,offset,littleEndian,noAssert);else _writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert)}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){_writeInt32(this,value,offset,true,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){_writeInt32(this,value,offset,false,noAssert)};function _writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}var len=buf.length;if(offset>=len)return;ieee754.write(buf,value,offset,littleEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){_writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){_writeFloat(this,value,offset,false,noAssert)};function _writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+7<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}var len=buf.length;if(offset>=len)return;ieee754.write(buf,value,offset,littleEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){_writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){_writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(typeof value==="string"){value=value.charCodeAt(0)}assert(typeof value==="number"&&!isNaN(value),"value is not a number");assert(end>=start,"end < start");if(end===start)return;if(this.length===0)return;assert(start>=0&&start<this.length,"start out of bounds");assert(end>=0&&end<=this.length,"end out of bounds");for(var i=start;i<end;i++){this[i]=value}};Buffer.prototype.inspect=function(){var out=[];var len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(Buffer._useTypedArrays){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1)buf[i]=this[i];return buf.buffer}}else{throw new Error("Buffer.toArrayBuffer not supported in this browser")}};function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}var BP=Buffer.prototype;Buffer._augment=function(arr){arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};function clamp(index,len,defaultValue){if(typeof index!=="number")return defaultValue;index=~~index;if(index>=len)return len;if(index>=0)return index;index+=len;if(index>=0)return index;return 0}function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function isArray(subject){return(Array.isArray||function(subject){return Object.prototype.toString.call(subject)==="[object Array]"})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){var b=str.charCodeAt(i);if(b<=127)byteArray.push(str.charCodeAt(i));else{var start=i;if(b>=55296&&b<=57343)i++;var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){var pos;for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert(typeof value==="number","cannot write a non-number as a number");assert(value>=0,"specified a negative value for writing an unsigned value");assert(value<=max,"value is larger than maximum value for type");assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert(typeof value==="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value");assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert(typeof value==="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}},{"base64-js":4,ieee754:5}],4:[function(_dereq_,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];
output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],5:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],6:[function(_dereq_,module,exports){var Buffer=_dereq_("buffer").Buffer;var intSize=4;var zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);var chrsz=8;function toArray(buf,bigEndian){if(buf.length%intSize!==0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}var arr=[];var fn=bigEndian?buf.readInt32BE:buf.readInt32LE;for(var i=0;i<buf.length;i+=intSize){arr.push(fn.call(buf,i))}return arr}function toBuffer(arr,size,bigEndian){var buf=new Buffer(size);var fn=bigEndian?buf.writeInt32BE:buf.writeInt32LE;for(var i=0;i<arr.length;i++){fn.call(buf,arr[i],i*4,true)}return buf}function hash(buf,fn,hashSize,bigEndian){if(!Buffer.isBuffer(buf))buf=new Buffer(buf);var arr=fn(toArray(buf,bigEndian),buf.length*chrsz);return toBuffer(arr,hashSize,bigEndian)}module.exports={hash:hash}},{buffer:3}],7:[function(_dereq_,module,exports){var Buffer=_dereq_("buffer").Buffer;var sha=_dereq_("./sha");var sha256=_dereq_("./sha256");var rng=_dereq_("./rng");var md5=_dereq_("./md5");var algorithms={sha1:sha,sha256:sha256,md5:md5};var blocksize=64;var zeroBuffer=new Buffer(blocksize);zeroBuffer.fill(0);function hmac(fn,key,data){if(!Buffer.isBuffer(key))key=new Buffer(key);if(!Buffer.isBuffer(data))data=new Buffer(data);if(key.length>blocksize){key=fn(key)}else if(key.length<blocksize){key=Buffer.concat([key,zeroBuffer],blocksize)}var ipad=new Buffer(blocksize),opad=new Buffer(blocksize);for(var i=0;i<blocksize;i++){ipad[i]=key[i]^54;opad[i]=key[i]^92}var hash=fn(Buffer.concat([ipad,data]));return fn(Buffer.concat([opad,hash]))}function hash(alg,key){alg=alg||"sha1";var fn=algorithms[alg];var bufs=[];var length=0;if(!fn)error("algorithm:",alg,"is not yet supported");return{update:function(data){if(!Buffer.isBuffer(data))data=new Buffer(data);bufs.push(data);length+=data.length;return this},digest:function(enc){var buf=Buffer.concat(bufs);var r=key?hmac(fn,key,buf):fn(buf);bufs=null;return enc?r.toString(enc):r}}}function error(){var m=[].slice.call(arguments).join(" ");throw new Error([m,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}exports.createHash=function(alg){return hash(alg)};exports.createHmac=function(alg,key){return hash(alg,key)};exports.randomBytes=function(size,callback){if(callback&&callback.call){try{callback.call(this,undefined,new Buffer(rng(size)))}catch(err){callback(err)}}else{return new Buffer(rng(size))}};function each(a,f){for(var i in a)f(a[i],i)}each(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(name){exports[name]=function(){error("sorry,",name,"is not implemented yet")}})},{"./md5":8,"./rng":9,"./sha":10,"./sha256":11,buffer:3}],8:[function(_dereq_,module,exports){var helpers=_dereq_("./helpers");function md5_vm_test(){return hex_md5("abc")=="900150983cd24fb0d6963f7d28e17f72"}function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function md5(buf){return helpers.hash(buf,core_md5,16)}},{"./helpers":6}],9:[function(_dereq_,module,exports){(function(){var _global=this;var mathRNG,whatwgRNG;mathRNG=function(size){var bytes=new Array(size);var r;for(var i=0,r;i<size;i++){if((i&3)==0)r=Math.random()*4294967296;bytes[i]=r>>>((i&3)<<3)&255}return bytes};if(_global.crypto&&crypto.getRandomValues){whatwgRNG=function(size){var bytes=new Uint8Array(size);crypto.getRandomValues(bytes);return bytes}}module.exports=whatwgRNG||mathRNG})()},{}],10:[function(_dereq_,module,exports){var helpers=_dereq_("./helpers");function core_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function sha1(buf){return helpers.hash(buf,core_sha1,20,true)}},{"./helpers":6}],11:[function(_dereq_,module,exports){var helpers=_dereq_("./helpers");var safe_add=function(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535};var S=function(X,n){return X>>>n|X<<32-n};var R=function(X,n){return X>>>n};var Ch=function(x,y,z){return x&y^~x&z};var Maj=function(x,y,z){return x&y^x&z^y&z};var Sigma0256=function(x){return S(x,2)^S(x,13)^S(x,22)};var Sigma1256=function(x){return S(x,6)^S(x,11)^S(x,25)};var Gamma0256=function(x){return S(x,7)^S(x,18)^R(x,3)};var Gamma1256=function(x){return S(x,17)^S(x,19)^R(x,10)};var core_sha256=function(m,l){var K=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298);var HASH=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225);var W=new Array(64);var a,b,c,d,e,f,g,h,i,j;var T1,T2;m[l>>5]|=128<<24-l%32;m[(l+64>>9<<4)+15]=l;for(var i=0;i<m.length;i+=16){a=HASH[0];b=HASH[1];c=HASH[2];d=HASH[3];e=HASH[4];f=HASH[5];g=HASH[6];h=HASH[7];for(var j=0;j<64;j++){if(j<16){W[j]=m[j+i]}else{W[j]=safe_add(safe_add(safe_add(Gamma1256(W[j-2]),W[j-7]),Gamma0256(W[j-15])),W[j-16])}T1=safe_add(safe_add(safe_add(safe_add(h,Sigma1256(e)),Ch(e,f,g)),K[j]),W[j]);T2=safe_add(Sigma0256(a),Maj(a,b,c));h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}HASH[0]=safe_add(a,HASH[0]);HASH[1]=safe_add(b,HASH[1]);HASH[2]=safe_add(c,HASH[2]);HASH[3]=safe_add(d,HASH[3]);HASH[4]=safe_add(e,HASH[4]);HASH[5]=safe_add(f,HASH[5]);HASH[6]=safe_add(g,HASH[6]);HASH[7]=safe_add(h,HASH[7])}return HASH};module.exports=function sha256(buf){return helpers.hash(buf,core_sha256,32,true)}},{"./helpers":6}],12:[function(_dereq_,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],13:[function(_dereq_,module,exports){var crypto=_dereq_("crypto");var defineProperty=Object.defineProperty;function next(){return"@@symbol:"+crypto.randomBytes(8).toString("hex")}function Symbol(desc){if(!(this instanceof Symbol)){return new Symbol(desc)}var _symbol=this._symbol=next();defineProperty(this,"_desc",{value:desc,enumerable:false,writable:false,configurable:false});defineProperty(Object.prototype,_symbol,{set:function(value){defineProperty(this,_symbol,{value:value,enumerable:false,writable:true})}})}Symbol.prototype.toString=function toString(){return this._symbol};var globalSymbolRegistry={};Symbol.for=function symbolFor(key){key=String(key);return globalSymbolRegistry[key]||(globalSymbolRegistry[key]=Symbol(key))};Symbol.keyFor=function keyFor(sym){if(!(sym instanceof Symbol)){throw new TypeError("Symbol.keyFor requires a Symbol argument")}for(var key in globalSymbolRegistry){if(globalSymbolRegistry[key]===sym){return key}}return undefined};module.exports=this.Symbol||Symbol},{crypto:7}],14:[function(_dereq_,module,exports){module.exports=extend;function extend(origin,add){if(!add||typeof add!=="object")return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin}},{}],15:[function(_dereq_,module,exports){"use strict";var GrammarDecl=_dereq_("./GrammarDecl");var pexprs=_dereq_("./pexprs");function Builder(){}Builder.prototype={newGrammar:function(name){return new GrammarDecl(name)},anything:function(){return pexprs.anything},end:function(){return pexprs.end},prim:function(x){return pexprs.makePrim(x)},range:function(from,to){return new pexprs.Range(from,to)},param:function(index){return new pexprs.Param(index)},alt:function(){var terms=[];for(var idx=0;idx<arguments.length;idx++){var arg=arguments[idx];if(arg instanceof pexprs.Alt){terms=terms.concat(arg.terms)}else{terms.push(arg)}}return terms.length===1?terms[0]:new pexprs.Alt(terms)},seq:function(){var factors=[];for(var idx=0;idx<arguments.length;idx++){var arg=arguments[idx];if(arg instanceof pexprs.Seq){factors=factors.concat(arg.factors)}else{factors.push(arg)}}return factors.length===1?factors[0]:new pexprs.Seq(factors)},star:function(expr){return new pexprs.Star(expr)},plus:function(expr){return new pexprs.Plus(expr)},opt:function(expr){return new pexprs.Opt(expr)},not:function(expr){return new pexprs.Not(expr)},la:function(expr){return new pexprs.Lookahead(expr)},lex:function(expr){return new pexprs.Lex(expr)},arr:function(expr){return new pexprs.Arr(expr)},str:function(expr){return new pexprs.Str(expr)},obj:function(properties,isLenient){return new pexprs.Obj(properties,!!isLenient)},app:function(ruleName,optParams){return new pexprs.Apply(ruleName,optParams)}};module.exports=Builder},{"./GrammarDecl":17,"./pexprs":43}],16:[function(_dereq_,module,exports){"use strict";var InputStream=_dereq_("./InputStream");var Interval=_dereq_("./Interval");var MatchResult=_dereq_("./MatchResult");var Semantics=_dereq_("./Semantics");var State=_dereq_("./State");var common=_dereq_("./common");var errors=_dereq_("./errors");var nodes=_dereq_("./nodes");var pexprs=_dereq_("./pexprs");function Grammar(name,superGrammar,ruleDict,optDefaultStartRule){this.name=name;this.superGrammar=superGrammar;this.ruleDict=ruleDict;if(optDefaultStartRule){if(!(optDefaultStartRule in ruleDict)){throw new Error("Invalid start rule: '"+optDefaultStartRule+"' is not a rule in grammar '"+name+"'")}this.defaultStartRule=optDefaultStartRule}this.constructors=this.ctors=this.createConstructors()}Grammar.prototype={construct:function(ruleName,children){var body=this.ruleDict[ruleName];if(!body||!body.check(this,children)||children.length!==body.getArity()){throw new errors.InvalidConstructorCall(this,ruleName,children)}var interval=new Interval(InputStream.newFor(children),0,children.length);return new nodes.Node(this,ruleName,children,interval)},createConstructors:function(){var self=this;var constructors={};function makeConstructor(ruleName){return function(){return self.construct(ruleName,Array.prototype.slice.call(arguments))}}for(var ruleName in this.ruleDict){constructors[ruleName]=makeConstructor(ruleName)}return constructors},isBuiltIn:function(){return this===Grammar.ProtoBuiltInRules||this===Grammar.BuiltInRules},match:function(obj,optStartRule){var startRule=optStartRule||this.defaultStartRule;if(!startRule){throw new Error("Missing start rule argument -- the grammar has no default start rule.")}var state=this._match(obj,startRule,false);return MatchResult.newFor(state)},_match:function(obj,startRule,tracingEnabled){var inputStream=InputStream.newFor(typeof obj==="string"?obj:[obj]);var state=new State(this,inputStream,startRule,tracingEnabled);var succeeded=new pexprs.Apply(startRule).eval(state);if(succeeded){var stack=[undefined];var helpers=this.semantics().addOperation("setParents",{_terminal:function(){this._node.parent=stack[stack.length-1]},_iter:function(children){stack.push(this._node);children.forEach(function(child){child.setParents()});stack.pop();this._node.parent=stack[stack.length-1]},_default:function(children){stack.push(this._node);children.forEach(function(child){child.setParents()});stack.pop();this._node.parent=stack[stack.length-1]}});helpers(MatchResult.newFor(state)).setParents()}return state},trace:function(obj,optStartRule){var startRule=optStartRule||this.defaultStartRule;if(!startRule){throw new Error("Missing start rule argument -- the grammar has no default start rule.")}var state=this._match(obj,startRule,true);var rootTrace=state.trace[0];rootTrace.state=state;rootTrace.result=MatchResult.newFor(state);return rootTrace},semantics:function(){return Semantics.createSemantics(this)},extendSemantics:function(superSemantics){return Semantics.createSemantics(this,superSemantics._getSemantics())},_checkTopDownActionDict:function(what,name,actionDict){function isSpecialAction(name){return name==="_terminal"||name==="_iter"||name==="_default"}var problems=[];for(var k in actionDict){var v=actionDict[k];if(!isSpecialAction(k)&&!(k in this.ruleDict)){problems.push("'"+k+"' is not a valid semantic action for '"+this.name+"'")}else if(typeof v!=="function"){problems.push("'"+k+"' must be a function in an action dictionary for '"+this.name+"'")}else{var actual=v.length;var expected=this._topDownActionArity(k);if(actual!==expected){problems.push("Semantic action '"+k+"' has the wrong arity: "+"expected "+expected+", got "+actual)}}}if(problems.length>0){var prettyProblems=problems.map(function(problem){return"- "+problem});var error=new Error("Found errors in the action dictionary of the '"+name+"' "+what+":\n"+prettyProblems.join("\n"));error.problems=problems;throw error}},_topDownActionArity:function(actionName){if(actionName==="_default"||actionName==="_iter"){return 1}else if(actionName==="_terminal"){return 0}return this.ruleDict[actionName].getArity()},_inheritsFrom:function(grammar){var g=this.superGrammar;while(g){if(g===grammar){return true}g=g.superGrammar}return false},toRecipe:function(optVarName){if(this.isBuiltIn()){throw new Error("Why would anyone want to generate a recipe for the "+this.name+" grammar?!?!")}var sb=new common.StringBuffer;if(optVarName){sb.append("var "+optVarName+" = ")}sb.append("(function() {\n");var superGrammarDecl="";if(!this.superGrammar.isBuiltIn()){sb.append(this.superGrammar.toRecipe("buildSuperGrammar"));superGrammarDecl="    .withSuperGrammar(buildSuperGrammar.call(this))\n"}sb.append("  return new this.newGrammar("+JSON.stringify(this.name)+")\n");sb.append(superGrammarDecl);if(this.defaultStartRule){sb.append("    .withDefaultStartRule('"+this.defaultStartRule+"')\n")}var self=this;Object.keys(this.ruleDict).forEach(function(ruleName){var body=self.ruleDict[ruleName];sb.append("    .");if(self.superGrammar.ruleDict[ruleName]){sb.append(body instanceof pexprs.Extend?"extend":"override")}else{sb.append("define")}var formals="["+body.formals.map(JSON.stringify).join(", ")+"]";sb.append("("+JSON.stringify(ruleName)+", "+formals+", ");body.outputRecipe(sb,body.formals);if(body.description){sb.append(", "+JSON.stringify(body.description))}sb.append(")\n")});sb.append("    .build();\n});\n");return sb.contents()},toOperationActionDictionaryTemplate:function(){return this._toOperationOrAttributeActionDictionaryTemplate()},toAttributeActionDictionaryTemplate:function(){return this._toOperationOrAttributeActionDictionaryTemplate()},_toOperationOrAttributeActionDictionaryTemplate:function(){var sb=new common.StringBuffer;sb.append("{");var first=true;for(var ruleName in this.ruleDict){if(ruleName==="spaces_"){continue}var body=this.ruleDict[ruleName];if(first){first=false}else{sb.append(",")}sb.append("\n");sb.append("  ");this.addSemanticActionTemplate(ruleName,body,sb)}sb.append("\n}");return sb.contents()},addSemanticActionTemplate:function(ruleName,body,sb){sb.append(ruleName);sb.append(": function(");var arity=this._topDownActionArity(ruleName);sb.append(common.repeat("_",arity).join(", "));sb.append(") {\n");sb.append("  }")}};Grammar.ProtoBuiltInRules=new Grammar("ProtoBuiltInRules",undefined,{_:pexprs.anything.withFormals([]),end:pexprs.end.withFormals([]),spaces_:new pexprs.Star(new pexprs.Apply("space")).withFormals([]),space:new pexprs.Range("\x00"," ").withFormals([]).withDescription("a space")});module.exports=Grammar},{"./InputStream":18,"./Interval":19,"./MatchResult":20,"./Semantics":23,"./State":24,"./common":26,"./errors":27,"./nodes":29,"./pexprs":43}],17:[function(_dereq_,module,exports){"use strict";var Grammar=_dereq_("./Grammar");var common=_dereq_("./common");var errors=_dereq_("./errors");var pexprs=_dereq_("./pexprs");function GrammarDecl(name){this.name=name}function onOhmError(doFn,onErrorFn){try{doFn()}catch(e){if(e instanceof errors.Error){onErrorFn(e)}else{throw e}}}GrammarDecl.prototype.ensureSuperGrammar=function(){if(!this.superGrammar){this.withSuperGrammar(this.name==="BuiltInRules"?Grammar.ProtoBuiltInRules:Grammar.BuiltInRules)}return this.superGrammar};GrammarDecl.prototype.installOverriddenOrExtendedRule=function(name,formals,body){var duplicateParameterNames=common.getDuplicates(formals);if(duplicateParameterNames.length>0){throw new errors.DuplicateParameterNames(name,duplicateParameterNames,body)}var baseRule=this.ensureSuperGrammar().ruleDict[name];if(formals.length!==baseRule.formals.length){throw new errors.WrongNumberOfParameters(name,baseRule.formals.length,formals.length,body)}return this.install(name,formals,baseRule.description,body)};GrammarDecl.prototype.install=function(name,formals,description,body){body=body.introduceParams(formals);body.formals=formals;body.description=description;this.ruleDict[name]=body;return this};GrammarDecl.prototype.withSuperGrammar=function(superGrammar){if(this.superGrammar){throw new Error("the super grammar of a GrammarDecl cannot be set more than once")}this.superGrammar=superGrammar;this.ruleDict=Object.create(superGrammar.ruleDict);if(!superGrammar.isBuiltIn()){this.defaultStartRule=superGrammar.defaultStartRule}return this};GrammarDecl.prototype.withDefaultStartRule=function(ruleName){this.defaultStartRule=ruleName;return this};GrammarDecl.prototype.build=function(){var grammar=new Grammar(this.name,this.ensureSuperGrammar(),this.ruleDict,this.defaultStartRule);var grammarErrors=[];var grammarHasInvalidApplications=false;Object.keys(grammar.ruleDict).forEach(function(ruleName){var body=grammar.ruleDict[ruleName];onOhmError(function(){body.assertChoicesHaveUniformArity(ruleName)},function(e){grammarErrors.push(e)});onOhmError(function(){body.assertAllApplicationsAreValid(ruleName,grammar)},function(e){grammarErrors.push(e);grammarHasInvalidApplications=true})});if(!grammarHasInvalidApplications){Object.keys(grammar.ruleDict).forEach(function(ruleName){var body=grammar.ruleDict[ruleName];onOhmError(function(){body.assertIteratedExprsAreNotNullable(grammar,ruleName)},function(e){grammarErrors.push(e)})})}if(grammarErrors.length>0){errors.throwErrors(grammarErrors)}return grammar};GrammarDecl.prototype.define=function(name,formals,body,optDescr){this.ensureSuperGrammar();if(this.superGrammar.ruleDict[name]){throw new errors.DuplicateRuleDeclaration(name,this.name,this.superGrammar.name,body)}else if(this.ruleDict[name]){throw new errors.DuplicateRuleDeclaration(name,this.name,this.name,body)}var duplicateParameterNames=common.getDuplicates(formals);if(duplicateParameterNames.length>0){throw new errors.DuplicateParameterNames(name,duplicateParameterNames,body)}return this.install(name,formals,optDescr,body)};GrammarDecl.prototype.override=function(name,formals,body){var baseRule=this.ensureSuperGrammar().ruleDict[name];if(!baseRule){throw new errors.CannotOverrideUndeclaredRule(name,this.superGrammar.name,body)}this.installOverriddenOrExtendedRule(name,formals,body);return this};GrammarDecl.prototype.extend=function(name,formals,body){var baseRule=this.ensureSuperGrammar().ruleDict[name];if(!baseRule){throw new errors.CannotExtendUndeclaredRule(name,this.superGrammar.name,body)}this.installOverriddenOrExtendedRule(name,formals,new pexprs.Extend(this.superGrammar,name,body));return this};module.exports=GrammarDecl},{"./Grammar":16,"./common":26,"./errors":27,"./pexprs":43}],18:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var Interval=_dereq_("./Interval");function InputStream(){throw new Error("InputStream cannot be instantiated -- it's abstract")}InputStream.newFor=function(obj){if(typeof obj==="string"){return new StringInputStream(obj)}else if(Array.isArray(obj)){return new ListInputStream(obj)}else if(obj instanceof InputStream){return obj}else{throw new Error("cannot make input stream for "+obj)}};InputStream.prototype={init:function(source){this.source=source;this.pos=0;this.posInfos=[]},atEnd:function(){return this.pos===this.source.length},next:function(){if(this.atEnd()){return common.fail}else{return this.source[this.pos++]}},matchExactly:function(x){return this.next()===x?true:common.fail},sourceSlice:function(startIdx,endIdx){return this.source.slice(startIdx,endIdx)},interval:function(startIdx,optEndIdx){return new Interval(this,startIdx,optEndIdx?optEndIdx:this.pos)}};function StringInputStream(source){this.init(source)}StringInputStream.prototype=Object.create(InputStream.prototype,{matchString:{value:function(s){for(var idx=0;idx<s.length;idx++){if(this.matchExactly(s[idx])===common.fail){return common.fail}}return true}}});function ListInputStream(source){this.init(source)}ListInputStream.prototype=Object.create(InputStream.prototype,{matchString:{value:function(s){return this.matchExactly(s)}}});module.exports=InputStream},{"./Interval":19,"./common":26}],19:[function(_dereq_,module,exports){"use strict";var errors=_dereq_("./errors");var util=_dereq_("./util");function Interval(inputStream,startIdx,endIdx){this.inputStream=inputStream;this.startIdx=startIdx;this.endIdx=endIdx}Interval.coverage=function(){var inputStream=arguments[0].inputStream;var startIdx=arguments[0].startIdx;var endIdx=arguments[0].endIdx;for(var idx=1;idx<arguments.length;idx++){var interval=arguments[idx];if(interval.inputStream!==inputStream){throw new errors.IntervalSourcesDontMatch}else{startIdx=Math.min(startIdx,arguments[idx].startIdx);endIdx=Math.max(endIdx,arguments[idx].endIdx)}}return new Interval(inputStream,startIdx,endIdx)};Interval.prototype={coverageWith:function(){var intervals=Array.prototype.slice.call(arguments);intervals.push(this);return Interval.coverage.apply(undefined,intervals)},collapsedLeft:function(){return new Interval(this.inputStream,this.startIdx,this.startIdx)},collapsedRight:function(){return new Interval(this.inputStream,this.endIdx,this.endIdx)},getLineAndColumnMessage:function(){var range=[this.startIdx,this.endIdx];return util.getLineAndColumnMessage(this.inputStream.source,this.startIdx,range)},trimmed:function(){var contents=this.contents;var startIdx=this.startIdx+contents.match(/^\s*/)[0].length;var endIdx=this.endIdx-contents.match(/\s*$/)[0].length;return new Interval(this.inputStream,startIdx,endIdx)}};Object.defineProperties(Interval.prototype,{contents:{get:function(){if(this._contents===undefined){this._contents=this.inputStream.sourceSlice(this.startIdx,this.endIdx)}return this._contents},enumerable:true}});module.exports=Interval},{"./errors":27,"./util":44}],20:[function(_dereq_,module,exports){"use strict";var inherits=_dereq_("inherits");var common=_dereq_("./common");var util=_dereq_("./util");var Interval=_dereq_("./Interval");function getShortMatchErrorMessage(pos,source,detail){var errorInfo=util.getLineAndColumn(source,pos);return"Line "+errorInfo.lineNum+", col "+errorInfo.colNum+": "+detail}function MatchResult(state){this.state=state;this._cst=state.bindings[0]}MatchResult.newFor=function(state){var succeeded=state.bindings.length===1;return succeeded?new MatchResult(state):new MatchFailure(state)};MatchResult.prototype.failed=function(){return false};MatchResult.prototype.succeeded=function(){return!this.failed()};function MatchFailure(state){this.state=state;common.defineLazyProperty(this,"_exprsAndStacks",function(){return this.state.getFailures()});common.defineLazyProperty(this,"message",function(){var source=this.state.inputStream.source;if(typeof source!=="string"){return"match failed at position "+this.getPos()}var detail="Expected "+this.getExpectedText();return util.getLineAndColumnMessage(source,this.getPos())+detail});common.defineLazyProperty(this,"shortMessage",function(){if(typeof this.state.inputStream.source!=="string"){return"match failed at position "+this.getPos()}var detail="expected "+this.getExpectedText();return getShortMatchErrorMessage(this.getPos(),this.state.inputStream.source,detail)})}inherits(MatchFailure,MatchResult);MatchFailure.prototype.toString=function(){return"[MatchFailure at position "+this.getPos()+"]"};MatchFailure.prototype.failed=function(){return true};MatchFailure.prototype.getPos=function(){return this.state.getFailuresPos()};MatchFailure.prototype.getInterval=function(){var pos=this.state.getFailuresPos();return new Interval(this.state.inputStream,pos,pos)};MatchFailure.prototype.getExpectedText=function(){var sb=new common.StringBuffer;var expected=this.getExpected();for(var idx=0;idx<expected.length;idx++){if(idx>0){if(idx===expected.length-1){sb.append(expected.length>2?", or ":" or ")}else{sb.append(", ")}}sb.append(expected[idx])}return sb.contents()};MatchFailure.prototype.getExpected=function(){var expected={};var ruleDict=this.state.grammar.ruleDict;this._exprsAndStacks.forEach(function(obj){expected[obj.expr.toExpected(ruleDict)]=true});return Object.keys(expected)};module.exports=MatchResult},{"./Interval":19,"./common":26,"./util":44,inherits:12}],21:[function(_dereq_,module,exports){"use strict";var extend=_dereq_("util-extend");function Namespace(){}Namespace.prototype=Object.create(null);Namespace.asNamespace=function(objOrNamespace){if(objOrNamespace instanceof Namespace){return objOrNamespace}return Namespace.createNamespace(objOrNamespace)};Namespace.createNamespace=function(optProps){return Namespace.extend(Namespace.prototype,optProps)};Namespace.extend=function(namespace,optProps){if(namespace!==Namespace.prototype&&!(namespace instanceof Namespace)){throw new TypeError("not a Namespace object: "+namespace)}var ns=Object.create(namespace,{constructor:{value:Namespace,enumerable:false,writable:true,configurable:true}});return extend(ns,optProps);
};Namespace.toString=function(ns){return Object.prototype.toString.call(ns)};module.exports=Namespace},{"util-extend":14}],22:[function(_dereq_,module,exports){"use strict";function PosInfo(globalApplicationStack){this.globalApplicationStack=globalApplicationStack;this.applicationStack=[];this.memo={};this.activeApplications=[]}PosInfo.prototype={isActive:function(application){return this.activeApplications.indexOf(application.toMemoKey())!==-1},enter:function(application){this.globalApplicationStack.push(application);this.applicationStack.push(application);this.activeApplications.push(application.toMemoKey())},exit:function(){this.globalApplicationStack.pop();this.applicationStack.pop();this.activeApplications.pop()},shouldUseMemoizedResult:function(application,memoRec){var involvedApplications=memoRec.involvedApplications;if(involvedApplications!=null){var keys=Object.keys(involvedApplications);for(var i=0;i<keys.length;++i){var memoKey=keys[i];if(involvedApplications[memoKey]&&this.activeApplications.indexOf(memoKey)!==-1){return false}}}return true},getCurrentLeftRecursion:function(){if(this.leftRecursionStack){return this.leftRecursionStack[this.leftRecursionStack.length-1]}},startLeftRecursion:function(application){if(!this.leftRecursionStack){this.leftRecursionStack=[]}this.leftRecursionStack.push({memoKey:application.toMemoKey(),value:false,pos:-1,involvedApplications:{}});this.updateInvolvedApplications()},endLeftRecursion:function(application){this.leftRecursionStack.pop()},updateInvolvedApplications:function(){var currentLeftRecursion=this.getCurrentLeftRecursion();var involvedApplications=currentLeftRecursion.involvedApplications;var lrApplicationMemoKey=currentLeftRecursion.memoKey;var idx=this.applicationStack.length-1;while(true){var memoKey=this.applicationStack[idx--].toMemoKey();if(memoKey===lrApplicationMemoKey){break}involvedApplications[memoKey]=true}}};module.exports=PosInfo},{}],23:[function(_dereq_,module,exports){"use strict";var Symbol=_dereq_("symbol");var inherits=_dereq_("inherits");var MatchResult=_dereq_("./MatchResult");var common=_dereq_("./common");function Wrapper(){}Wrapper.prototype.toString=function(){return"[semantics wrapper for "+this._node.grammar.name+"]"};Wrapper.prototype.child=function(idx){if(!(0<=idx&&idx<this._node.numChildren())){return undefined}var childWrapper=this._childWrappers[idx];if(!childWrapper){childWrapper=this._childWrappers[idx]=this._semantics.wrap(this._node.childAt(idx))}return childWrapper};Wrapper.prototype._children=function(){for(var idx=0;idx<this._node.numChildren();idx++){this.child(idx)}return this._childWrappers};Wrapper.prototype._onlyChild=function(){if(this._node.numChildren()!==1){throw new Error("cannot get only child of a node of type "+this.ctorName()+" (it has "+this._node.numChildren()+" children)")}else{return this.child(0)}};Wrapper.prototype.isIteration=function(){return this._node.ctorName==="_iter"};Wrapper.prototype.isTerminal=function(){return this._node.isTerminal()};Object.defineProperties(Wrapper.prototype,{children:{get:function(){return this._children()}},ctorName:{get:function(){return this._node.ctorName}},interval:{get:function(){return this._node.interval}},numChildren:{get:function(){return this._node.numChildren()}},primitiveValue:{get:function(){if(this.isTerminal()){return this._node.primitiveValue}throw new TypeError("tried to access the 'primitiveValue' attribute of a non-terminal CST node")}}});function Semantics(grammar,optSuperSemantics){var self=this;this.grammar=grammar;this.checkedActionDicts=false;this.Wrapper=function(node){self.checkActionDictsIfHaventAlready();this._semantics=self;this._node=node;this._childWrappers=[]};if(optSuperSemantics){this.super=optSuperSemantics;if(grammar!==this.super.grammar&&!grammar._inheritsFrom(this.super.grammar)){throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+grammar.name+"' (not a sub-grammar)")}inherits(this.Wrapper,this.super.Wrapper);this.operations=Object.create(this.super.operations);this.attributes=Object.create(this.super.attributes);this.attributeKeys=Object.create(null);for(var attributeName in this.attributes){this.attributeKeys[attributeName]=Symbol()}}else{inherits(this.Wrapper,Wrapper);this.operations=Object.create(null);this.attributes=Object.create(null);this.attributeKeys=Object.create(null)}}Semantics.prototype.toString=function(){return"[semantics for "+this.grammar.name+"]"};Semantics.prototype.checkActionDictsIfHaventAlready=function(){if(!this.checkedActionDicts){this.checkActionDicts();this.checkedActionDicts=true}};Semantics.prototype.checkActionDicts=function(){for(var name in this.operations){this.operations[name].checkActionDict(this.grammar)}for(name in this.attributes){this.attributes[name].checkActionDict(this.grammar)}};Semantics.prototype.addOperationOrAttribute=function(type,name,actionDict){var typePlural=type+"s";var Ctor=type==="operation"?Operation:Attribute;this.assertNewName(name,type);var realActionDict={_terminal:function(){return this.primitiveValue},_iter:function(children){var thisSemantics=this._semantics;var thisThing=thisSemantics[typePlural][name];return children.map(function(child){return thisThing.execute(thisSemantics,child)})},_default:function(children){if(children.length===1){var thisSemantics=this._semantics;var thisThing=thisSemantics[typePlural][name];return thisThing.execute(thisSemantics,children[0])}throw new Error("missing semantic action for "+this.ctorName+" in "+name+" "+type)}};Object.keys(actionDict).forEach(function(name){realActionDict[name]=actionDict[name]});this[typePlural][name]=new Ctor(name,realActionDict);this[typePlural][name].checkActionDict(this.grammar);function doIt(){var thisThing=this._semantics[typePlural][name];return thisThing.execute(this._semantics,this)}if(type==="operation"){this.Wrapper.prototype[name]=doIt;this.Wrapper.prototype[name].toString=function(){return"["+name+" operation]"}}else{Object.defineProperty(this.Wrapper.prototype,name,{get:doIt});this.attributeKeys[name]=Symbol()}};Semantics.prototype.extendOperationOrAttribute=function(type,name,actionDict){var typePlural=type+"s";var Ctor=type==="operation"?Operation:Attribute;if(!(this.super&&name in this.super[typePlural])){throw new Error("Cannot extend "+type+" '"+name+"': did not inherit an "+type+" with that name")}if(Object.prototype.hasOwnProperty.call(this[typePlural],name)){throw new Error("Cannot extend "+type+" '"+name+"' again")}var inheritedActionDict=this[typePlural][name].actionDict;var newActionDict=Object.create(inheritedActionDict);Object.keys(actionDict).forEach(function(name){newActionDict[name]=actionDict[name]});this[typePlural][name]=new Ctor(name,newActionDict);this[typePlural][name].checkActionDict(this.grammar)};Semantics.prototype.assertNewName=function(name,type){if(Wrapper.prototype.hasOwnProperty(name)){throw new Error("Cannot add "+type+" '"+name+"': that's a reserved name")}if(name in this.operations){throw new Error("Cannot add "+type+" '"+name+"': an operation with that name already exists")}if(name in this.attributes){throw new Error("Cannot add "+type+" '"+name+"': an attribute with that name already exists")}};Semantics.prototype.wrap=function(node){return new this.Wrapper(node)};Semantics.createSemantics=function(grammar,optSuperSemantics){var s=new Semantics(grammar,optSuperSemantics);var proxy=function ASemantics(matchResult){if(!(matchResult instanceof MatchResult)){throw new TypeError("Semantics expected a MatchResult, but got "+common.unexpectedObjToString(matchResult))}if(!matchResult.succeeded()){throw new TypeError("cannot apply Semantics to "+matchResult.toString())}var cst=matchResult._cst;if(cst.grammar!==grammar){throw new Error("Cannot use a CST node created by grammar '"+cst.grammar.name+"' with a semantics for '"+grammar.name+"'")}return s.wrap(cst)};proxy.addOperation=function(name,actionDict){s.addOperationOrAttribute.call(s,"operation",name,actionDict);return proxy};proxy.extendOperation=function(name,actionDict){s.extendOperationOrAttribute.call(s,"operation",name,actionDict);return proxy};proxy.addAttribute=function(name,actionDict){s.addOperationOrAttribute.call(s,"attribute",name,actionDict);return proxy};proxy.extendAttribute=function(name,actionDict){s.extendOperationOrAttribute.call(s,"attribute",name,actionDict);return proxy};proxy.toString=s.toString.bind(s);proxy._getSemantics=function(){return s};return proxy};function Operation(name,actionDict){this.name=name;this.actionDict=actionDict}Operation.prototype.typeName="operation";Operation.prototype.checkActionDict=function(grammar){grammar._checkTopDownActionDict(this.typeName,this.name,this.actionDict)};Operation.prototype.execute=function(semantics,nodeWrapper){var actionFn=this.actionDict[nodeWrapper._node.ctorName];if(actionFn){return this.doAction(semantics,nodeWrapper,actionFn,nodeWrapper.isIteration())}return this.doAction(semantics,nodeWrapper,this.actionDict._default,true)};Operation.prototype.doAction=function(semantics,nodeWrapper,actionFn,optPassChildrenAsArray){return optPassChildrenAsArray?actionFn.call(nodeWrapper,nodeWrapper._children()):actionFn.apply(nodeWrapper,nodeWrapper._children())};function Attribute(name,actionDict){this.name=name;this.actionDict=actionDict}inherits(Attribute,Operation);Attribute.prototype.typeName="attribute";Attribute.prototype.execute=function(semantics,nodeWrapper){var node=nodeWrapper._node;var key=semantics.attributeKeys[this.name];if(!node.hasOwnProperty(key)){node[key]=Operation.prototype.execute.call(this,semantics,nodeWrapper)}return node[key]};module.exports=Semantics},{"./MatchResult":20,"./common":26,inherits:12,symbol:13}],24:[function(_dereq_,module,exports){"use strict";var PosInfo=_dereq_("./PosInfo");var Trace=_dereq_("./Trace");var pexprs=_dereq_("./pexprs");var applySpaces_=new pexprs.Apply("spaces_");function State(grammar,inputStream,startRule,tracingEnabled){this.grammar=grammar;this.origInputStream=inputStream;this.startRule=startRule;this.tracingEnabled=tracingEnabled;this.rightmostFailPos=-1;this.init()}State.prototype={init:function(optFailuresArray){this.inputStreamStack=[];this.posInfosStack=[];this.pushInputStream(this.origInputStream);this.applicationStack=[];this.bindings=[];this.failures=optFailuresArray;this.ignoreFailuresCount=0;if(this.isTracing()){this.trace=[]}},currentApplication:function(){return this.applicationStack[this.applicationStack.length-1]},inSyntacticRule:function(){if(typeof this.inputStream.source!=="string"){return false}var currentApplication=this.currentApplication();return currentApplication&&currentApplication.isSyntactic()},skipSpaces:function(){this.ignoreFailures();applySpaces_.eval(this);this.bindings.pop();this.recordFailures();return this.inputStream.pos},skipSpacesIfInSyntacticContext:function(){if(this.inSyntacticRule()){this.skipSpaces()}return this.inputStream.pos},truncateBindings:function(newLength){while(this.bindings.length>newLength){this.bindings.pop()}},pushInputStream:function(inputStream){this.inputStreamStack.push(this.inputStream);this.posInfosStack.push(this.posInfos);this.inputStream=inputStream;this.posInfos=[]},popInputStream:function(){this.inputStream=this.inputStreamStack.pop();this.posInfos=this.posInfosStack.pop()},getCurrentPosInfo:function(){return this.getPosInfo(this.inputStream.pos)},getPosInfo:function(pos){var posInfo=this.posInfos[pos];return posInfo||(this.posInfos[pos]=new PosInfo(this.applicationStack))},recordFailure:function(pos,expr){if(this.ignoreFailuresCount>0){return}if(pos<this.rightmostFailPos){return}else if(pos>this.rightmostFailPos){this.rightmostFailPos=pos}if(!this.failures){return}function addStack(stack,stacks){for(var idx=0;idx<stacks.length;idx++){var otherStack=stacks[idx];if(stack.length!==otherStack.length){continue}for(var idx2=0;idx2<stack.length;idx2++){if(stack[idx2]!==otherStack[idx2]){break}}if(idx2===stack.length){return}}stacks.push(stack)}var stack=this.applicationStack.slice();var exprsAndStacks=this.failures;for(var idx=0;idx<exprsAndStacks.length;idx++){var exprAndStacks=exprsAndStacks[idx];if(exprAndStacks.expr===expr){addStack(stack,exprAndStacks.stacks);return}}exprsAndStacks.push({expr:expr,stacks:[stack]})},ignoreFailures:function(){this.ignoreFailuresCount++},recordFailures:function(){this.ignoreFailuresCount--},getFailuresPos:function(){return this.rightmostFailPos},getFailures:function(){if(!this.failures){this.init([]);this.tracingEnabled=false;var succeeded=new pexprs.Apply(this.startRule).eval(this);if(succeeded){this.failures=[]}}return this.failures},getMemoizedTraceEntry:function(pos,expr){var posInfo=this.posInfos[pos];if(posInfo&&expr.ruleName){var memoRec=posInfo.memo[expr.ruleName];if(memoRec){return memoRec.traceEntry}}return null},getTraceEntry:function(pos,expr,result){var entry=this.getMemoizedTraceEntry(pos,expr);if(!entry){entry=new Trace(this.inputStream,pos,expr,result,this.trace)}return entry},isTracing:function(){return this.tracingEnabled},applySpaces_:applySpaces_};module.exports=State},{"./PosInfo":22,"./Trace":25,"./pexprs":43}],25:[function(_dereq_,module,exports){"use strict";var Interval=_dereq_("./Interval");var common=_dereq_("./common");var BALLOT_X="";var CHECK_MARK="";var DOT_OPERATOR="";var RIGHTWARDS_DOUBLE_ARROW="";var SYMBOL_FOR_HORIZONTAL_TABULATION="";var SYMBOL_FOR_LINE_FEED="";var SYMBOL_FOR_CARRIAGE_RETURN="";function linkLeftRecursiveChildren(children){for(var i=0;i<children.length;++i){var child=children[i];var nextChild=children[i+1];if(nextChild&&child.expr===nextChild.expr){child.replacedBy=nextChild}}}function spaces(n){return common.repeat(" ",n).join("")}function getInputExcerpt(inputStream,pos,len){var excerpt=asEscapedString(inputStream.sourceSlice(pos,pos+len));if(excerpt.length<len){return excerpt+common.repeat(" ",len-excerpt.length).join("")}return excerpt}function asEscapedString(obj){if(typeof obj==="string"){return obj.replace(/ /g,DOT_OPERATOR).replace(/\t/g,SYMBOL_FOR_HORIZONTAL_TABULATION).replace(/\n/g,SYMBOL_FOR_LINE_FEED).replace(/\r/g,SYMBOL_FOR_CARRIAGE_RETURN)}return String(obj)}function Trace(inputStream,pos,expr,ans,optChildren){this.children=optChildren||[];this.expr=expr;if(ans){this.interval=new Interval(inputStream,pos,inputStream.pos)}this.isLeftRecursive=false;this.pos=pos;this.inputStream=inputStream;this.succeeded=!!ans}Object.defineProperty(Trace.prototype,"displayString",{get:function(){return this.expr.toDisplayString()}});Trace.prototype.setLeftRecursive=function(leftRecursive){this.isLeftRecursive=leftRecursive;if(leftRecursive){linkLeftRecursiveChildren(this.children)}};Trace.prototype.walk=function(visitorObjOrFn,optThisArg){var visitor=visitorObjOrFn;if(typeof visitor==="function"){visitor={enter:visitor}}return function _walk(node,parent,depth){if(visitor.enter){visitor.enter.call(optThisArg,node,parent,depth)}node.children.forEach(function(c){if(c&&"walk"in c){_walk(c,node,depth+1)}});if(visitor.exit){visitor.exit.call(optThisArg,node,parent,depth)}}(this,null,0)};Trace.prototype.toString=function(){var sb=new common.StringBuffer;this.walk(function(node,parent,depth){var ctorName=node.expr.constructor.name;if(ctorName==="Alt"){return}sb.append(getInputExcerpt(node.inputStream,node.pos,10)+spaces(depth*2+1));sb.append((node.succeeded?CHECK_MARK:BALLOT_X)+" "+node.displayString);if(node.isLeftRecursive){sb.append(" (LR)")}if(node.succeeded){var contents=asEscapedString(node.interval.contents);sb.append(" "+RIGHTWARDS_DOUBLE_ARROW+"  ");sb.append(typeof contents==="string"?'"'+contents+'"':contents)}sb.append("\n")});return sb.contents()};module.exports=Trace},{"./Interval":19,"./common":26}],26:[function(_dereq_,module,exports){"use strict";var extend=_dereq_("util-extend");var escapeStringFor={};for(var c=0;c<128;c++){escapeStringFor[c]=String.fromCharCode(c)}escapeStringFor["'".charCodeAt(0)]="\\'";escapeStringFor['"'.charCodeAt(0)]='\\"';escapeStringFor["\\".charCodeAt(0)]="\\\\";escapeStringFor["\b".charCodeAt(0)]="\\b";escapeStringFor["\f".charCodeAt(0)]="\\f";escapeStringFor["\n".charCodeAt(0)]="\\n";escapeStringFor["\r".charCodeAt(0)]="\\r";escapeStringFor["	".charCodeAt(0)]="\\t";escapeStringFor["".charCodeAt(0)]="\\v";exports.abstract=function(){throw new Error("this method is abstract! "+"(it has no implementation in class "+this.constructor.name+")")};exports.assert=function(cond,message){if(!cond){throw new Error(message)}};exports.defineLazyProperty=function(obj,propName,getterFn){var memo;Object.defineProperty(obj,propName,{get:function(){if(!memo){memo=getterFn.call(this)}return memo}})};exports.clone=function(obj){if(obj){return extend({},obj)}return obj};exports.extend=extend;exports.repeatFn=function(fn,n){var arr=[];while(n-->0){arr.push(fn())}return arr};exports.repeatStr=function(str,n){return new Array(n+1).join(str)};exports.repeat=function(x,n){return exports.repeatFn(function(){return x},n)};exports.getDuplicates=function(array){var duplicates=[];for(var idx=0;idx<array.length;idx++){var x=array[idx];if(array.lastIndexOf(x)!==idx&&duplicates.indexOf(x)<0){duplicates.push(x)}}return duplicates};exports.fail={};exports.isSyntactic=function(ruleName){var firstChar=ruleName[0];return"A"<=firstChar&&firstChar<="Z"};exports.padLeft=function(str,len,optChar){var ch=optChar||" ";if(str.length<len){return exports.repeatStr(ch,len-str.length)+str}return str};exports.StringBuffer=function(){this.strings=[]};exports.StringBuffer.prototype.append=function(str){this.strings.push(str)};exports.StringBuffer.prototype.contents=function(){return this.strings.join("")};exports.escapeChar=function(c,optDelim){var charCode=c.charCodeAt(0);if((c==='"'||c==="'")&&optDelim&&c!==optDelim){return c}else if(charCode<128){return escapeStringFor[charCode]}else if(128<=charCode&&charCode<256){return"\\x"+exports.padLeft(charCode.toString(16),2,"0")}else{return"\\u"+exports.padLeft(charCode.toString(16),4,"0")}};exports.unescapeChar=function(s){if(s.charAt(0)==="\\"){switch(s.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"	";case"v":return"";case"x":return String.fromCharCode(parseInt(s.substring(2,4),16));case"u":return String.fromCharCode(parseInt(s.substring(2,6),16));default:return s.charAt(1)}}else{return s}};exports.unexpectedObjToString=function(obj){if(obj==null){return String(obj)}var baseToString=Object.prototype.toString.call(obj);try{var typeName;if(obj.constructor&&obj.constructor.name){typeName=obj.constructor.name}else if(baseToString.indexOf("[object ")===0){typeName=baseToString.slice(8,-1)}else{typeName=typeof obj}return typeName+": "+JSON.stringify(String(obj))}catch(e){return baseToString}}},{"util-extend":14}],27:[function(_dereq_,module,exports){"use strict";var Namespace=_dereq_("./Namespace");function OhmError(){}OhmError.prototype=Object.create(Error.prototype);function makeCustomError(name,initFn){var E=function OhmError(){initFn.apply(this,arguments);if(typeof Error.captureStackTrace==="function"){Error.captureStackTrace(this,this.constructor)}else{var e=new Error;Object.defineProperty(this,"stack",{get:function(){return e.stack}})}};E.prototype=Object.create(OhmError.prototype);E.prototype.constructor=E;E.prototype.name=name;return E}var IntervalSourcesDontMatch=makeCustomError("ohm.error.IntervalSourcesDontMatch",function(){this.message="Interval sources don't match"});var GrammarSyntaxError=makeCustomError("ohm.error.GrammarSyntaxError",function(matchFailure){Object.defineProperty(this,"message",{get:function(){return"Failed to parse grammar:\n"+matchFailure.message}});Object.defineProperty(this,"shortMessage",{get:function(){return"Expected "+matchFailure.getExpectedText()}});this.interval=matchFailure.getInterval()});var UndeclaredGrammar=makeCustomError("ohm.error.UndeclaredGrammar",function(grammarName,namespace,interval){this.grammarName=grammarName;this.namespace=namespace;if(this.namespace){this.message="Grammar "+this.grammarName+" is not declared in namespace "+Namespace.toString(this.namespace)}else{this.message="Undeclared grammar "+this.grammarName}this.interval=interval});var DuplicateGrammarDeclaration=makeCustomError("ohm.error.DuplicateGrammarDeclaration",function(grammar,namespace){this.grammarName=grammar.name;this.namespace=namespace;this.message="Grammar "+this.grammarName+" is already declared in namespace "+Namespace.toString(this.namespace);this.interval=grammar.definitionInterval});var UndeclaredRule=makeCustomError("ohm.error.UndeclaredRule",function(ruleName,grammarName,expr){this.ruleName=ruleName;this.grammarName=grammarName;this.message="Rule "+this.ruleName+" is not declared in grammar "+this.grammarName;this.interval=expr.interval});var CannotOverrideUndeclaredRule=makeCustomError("ohm.error.CannotOverrideUndeclaredRule",function(ruleName,grammarName,body){this.ruleName=ruleName;this.grammarName=grammarName;this.message="Cannot override rule "+this.ruleName+" because it is not declared in "+this.grammarName;this.interval=body.definitionInterval});var CannotExtendUndeclaredRule=makeCustomError("ohm.error.CannotExtendUndeclaredRule",function(ruleName,grammarName,body){this.ruleName=ruleName;this.grammarName=grammarName;this.message="Cannot extend rule "+this.ruleName+" because it is not declared in "+this.grammarName;this.interval=body.definitionInterval});var DuplicateRuleDeclaration=makeCustomError("ohm.error.DuplicateRuleDeclaration",function(ruleName,offendingGrammarName,declGrammarName,body){this.ruleName=ruleName;this.offendingGrammarName=offendingGrammarName;this.declGrammarName=declGrammarName;this.message="Duplicate declaration for rule '"+this.ruleName+"' in grammar '"+this.offendingGrammarName+"'";if(this.offendingGrammarName!==declGrammarName){this.message+=" (originally declared in grammar '"+this.declGrammarName+"')"}this.interval=body.definitionInterval});var WrongNumberOfParameters=makeCustomError("ohm.error.WrongNumberOfParameters",function(ruleName,expected,actual,body){this.ruleName=ruleName;this.expected=expected;this.actual=actual;this.message="Wrong number of parameters for rule "+this.ruleName+" (expected "+this.expected+", got "+this.actual+")";this.interval=body.definitionInterval});var DuplicateParameterNames=makeCustomError("ohm.error.DuplicateParameterNames",function(ruleName,duplicates,body){this.ruleName=ruleName;this.duplicates=duplicates;this.message="Duplicate parameter names in rule "+this.ruleName+": "+this.duplicates.join(",");this.interval=body.definitionInterval});var InvalidParameter=makeCustomError("ohm.error.InvalidParameter",function(ruleName,expr){this.ruleName=ruleName;this.expr=expr;this.interval=expr.interval;this.message="Invalid parameter to rule "+this.ruleName+": "+this.expr+" has arity "+this.expr.getArity()+", but parameter expressions "+"must have arity 1"});var ApplicationOfSyntacticRuleFromLexicalRule=makeCustomError("ohm.error.ApplicationOfSyntacticRuleFromLexicalRule",function(lexicalRuleName,syntacticRuleName,applyExpr){this.lexicalRuleName=lexicalRuleName;this.syntacticRuleName=syntacticRuleName;this.applyExpr=applyExpr;this.interval=applyExpr.interval;this.shortMessage="Cannot apply syntactic rule "+syntacticRuleName+" from the body of lexical rule "+lexicalRuleName;this.message=applyExpr.interval.getLineAndColumnMessage()+this.shortMessage});var KleeneExprHasNullableOperand=makeCustomError("ohm.error.KleeneExprHasNullableOperand",function(kleeneExpr){this.expr=kleeneExpr;var operator=kleeneExpr.operator;var nullableExpr=kleeneExpr.expr;this.shortMessage="Nullable expression "+nullableExpr.interval.contents+" is not allowed inside '"+operator+"' (possible infinite loop)";this.message=nullableExpr.interval.getLineAndColumnMessage()+this.shortMessage;this.interval=nullableExpr.interval});var InconsistentArity=makeCustomError("ohm.error.InconsistentArity",function(ruleName,expected,actual,expr){this.ruleName=ruleName;this.expected=expected;this.actual=actual;this.message="Rule "+this.ruleName+" involves an alternation which has inconsistent arity "+"(expected "+this.expected+", got "+this.actual+")";this.interval=expr.interval});var DuplicatePropertyNames=makeCustomError("ohm.error.DuplicatePropertyNames",function(duplicates){this.duplicates=duplicates;this.message="Object pattern has duplicate property names: "+this.duplicates.join(", ")});var InvalidConstructorCall=makeCustomError("ohm.error.InvalidConstructorCall",function(grammar,ctorName,children){this.grammar=grammar;this.ctorName=ctorName;this.children=children;this.message="Attempt to invoke constructor "+this.ctorName+" with invalid or unexpected arguments"});var MultipleErrors=makeCustomError("ohm.error.MultipleErrors",function(errors){this.errors=errors;var messages=errors.map(function(e){return e.message});this.message=["Errors:"].concat(messages).join("\n- ");this.shortMessage=errors[0].shortMessage?errors[0].shortMessage:errors[0].message;this.interval=errors[0].interval});module.exports={ApplicationOfSyntacticRuleFromLexicalRule:ApplicationOfSyntacticRuleFromLexicalRule,CannotExtendUndeclaredRule:CannotExtendUndeclaredRule,CannotOverrideUndeclaredRule:CannotOverrideUndeclaredRule,DuplicateGrammarDeclaration:DuplicateGrammarDeclaration,DuplicateParameterNames:DuplicateParameterNames,DuplicatePropertyNames:DuplicatePropertyNames,DuplicateRuleDeclaration:DuplicateRuleDeclaration,Error:OhmError,InconsistentArity:InconsistentArity,IntervalSourcesDontMatch:IntervalSourcesDontMatch,InvalidConstructorCall:InvalidConstructorCall,InvalidParameter:InvalidParameter,GrammarSyntaxError:GrammarSyntaxError,KleeneExprHasNullableOperand:KleeneExprHasNullableOperand,MultipleErrors:MultipleErrors,UndeclaredGrammar:UndeclaredGrammar,UndeclaredRule:UndeclaredRule,WrongNumberOfParameters:WrongNumberOfParameters,throwErrors:function(errors){if(errors.length===1){throw errors[0]}if(errors.length>1){throw new MultipleErrors(errors)}}}},{"./Namespace":21}],28:[function(_dereq_,module,exports){(function(Buffer){"use strict";var Builder=_dereq_("./Builder");var Grammar=_dereq_("./Grammar");var Namespace=_dereq_("./Namespace");var common=_dereq_("./common");var errors=_dereq_("./errors");var util=_dereq_("./util");var ohmGrammar;var documentInterface={querySelector:function(sel){return document.querySelector(sel)},querySelectorAll:function(sel){return document.querySelectorAll(sel)}};function isElement(obj){return!!(obj&&obj.nodeType===1)}function isUndefined(obj){return obj===void 0}var MAX_ARRAY_INDEX=Math.pow(2,53)-1;function isArrayLike(obj){if(obj==null){return false}var length=obj.length;return typeof length==="number"&&length>=0&&length<=MAX_ARRAY_INDEX}function load(url){var req=new XMLHttpRequest;req.open("GET",url,false);try{req.send();if(req.status===0||req.status===200){return req.responseText}}catch(e){}throw new Error("unable to load url "+url)}function buildGrammar(match,namespace,optOhmGrammarForTesting){var builder;var decl;var currentRuleName;var currentRuleFormals;var overriding=false;var metaGrammar=optOhmGrammarForTesting||ohmGrammar;var helpers=metaGrammar.semantics().addOperation("visit",{Grammar:function(n,s,open,rs,close){builder=new Builder;var grammarName=n.visit();decl=builder.newGrammar(grammarName,namespace);s.visit();rs.visit();var g=decl.build();g.definitionInterval=this.interval.trimmed();if(grammarName in namespace){throw new errors.DuplicateGrammarDeclaration(g,namespace)}namespace[grammarName]=g;return g},SuperGrammar:function(_,n){var superGrammarName=n.visit();if(superGrammarName==="null"){decl.withSuperGrammar(null)}else{if(!namespace||!(superGrammarName in namespace)){throw new errors.UndeclaredGrammar(superGrammarName,namespace,n.interval)}decl.withSuperGrammar(namespace[superGrammarName])}},Rule_define:function(n,fs,d,_,b){currentRuleName=n.visit();currentRuleFormals=fs.visit()[0]||[];if(!decl.defaultStartRule&&decl.ensureSuperGrammar()!==Grammar.ProtoBuiltInRules){decl.withDefaultStartRule(currentRuleName)}var body=b.visit();body.definitionInterval=this.interval.trimmed();var description=d.visit()[0];return decl.define(currentRuleName,currentRuleFormals,body,description)},Rule_override:function(n,fs,_,b){currentRuleName=n.visit();currentRuleFormals=fs.visit()[0]||[];overriding=true;var body=b.visit();body.definitionInterval=this.interval.trimmed();var ans=decl.override(currentRuleName,currentRuleFormals,body);overriding=false;return ans},Rule_extend:function(n,fs,_,b){currentRuleName=n.visit();currentRuleFormals=fs.visit()[0]||[];var body=b.visit();var ans=decl.extend(currentRuleName,currentRuleFormals,body);decl.ruleDict[currentRuleName].definitionInterval=this.interval.trimmed();return ans},Formals:function(opointy,fs,cpointy){return fs.visit()},Params:function(opointy,ps,cpointy){return ps.visit()},Alt:function(term,_,terms){var args=[term.visit()].concat(terms.visit());return builder.alt.apply(builder,args).withInterval(this.interval)},Term_inline:function(b,n){var inlineRuleName=currentRuleName+"_"+n.visit();var body=b.visit();body.definitionInterval=this.interval.trimmed();var isNewRuleDeclaration=!(decl.superGrammar&&decl.superGrammar.ruleDict[inlineRuleName]);if(overriding&&!isNewRuleDeclaration){decl.override(inlineRuleName,currentRuleFormals,body)}else{decl.define(inlineRuleName,currentRuleFormals,body)}var params=currentRuleFormals.map(function(formal){return builder.app(formal)});return builder.app(inlineRuleName,params).withInterval(body.interval)},Seq:function(expr){return builder.seq.apply(builder,expr.visit()).withInterval(this.interval)},Iter_star:function(x,_){return builder.star(x.visit()).withInterval(this.interval)},Iter_plus:function(x,_){return builder.plus(x.visit()).withInterval(this.interval)},Iter_opt:function(x,_){return builder.opt(x.visit()).withInterval(this.interval)},Pred_not:function(_,x){return builder.not(x.visit()).withInterval(this.interval)},Pred_lookahead:function(_,x){return builder.la(x.visit()).withInterval(this.interval)},Lex_lex:function(_,x){return builder.lex(x.visit()).withInterval(this.interval)},Base_application:function(rule,ps){return builder.app(rule.visit(),ps.visit()[0]||[]).withInterval(this.interval)},Base_range:function(from,_,to){return builder.range(from.visit(),to.visit()).withInterval(this.interval)},Base_prim:function(expr){return builder.prim(expr.visit()).withInterval(this.interval)},Base_paren:function(open,x,close){return x.visit()},Base_arr:function(open,x,close){return builder.arr(x.visit()).withInterval(this.interval)},Base_str:function(open,x,close){return builder.str(x.visit())},Base_obj:function(open,lenient,close){return builder.obj([],lenient.visit()[0])},Base_objWithProps:function(open,ps,_,lenient,close){return builder.obj(ps.visit(),lenient.visit()[0]).withInterval(this.interval)},Props:function(p,_,ps){return[p.visit()].concat(ps.visit())},Prop:function(n,_,p){return{name:n.visit(),pattern:p.visit()}},ruleDescr:function(open,t,close){return t.visit()},ruleDescrText:function(_){return this.interval.contents.trim()},caseName:function(_,space1,n,space2,end){return n.visit()},name:function(first,rest){return this.interval.contents},nameFirst:function(expr){},nameRest:function(expr){},keyword_null:function(_){return null},keyword_true:function(_){return true},keyword_false:function(_){return false},string:function(open,cs,close){return cs.visit().map(function(c){return common.unescapeChar(c)}).join("")},strChar:function(_){return this.interval.contents},escapeChar:function(_){return this.interval.contents},number:function(_,digits){return parseInt(this.interval.contents)},space:function(expr){},space_multiLine:function(start,_,end){},space_singleLine:function(start,_,end){},ListOf_some:function(x,_,xs){return[x.visit()].concat(xs.visit())},ListOf_none:function(){return[]}});return helpers(match).visit()}function compileAndLoad(source,namespace){var m=ohmGrammar.match(source,"Grammars");if(m.failed()){throw new errors.GrammarSyntaxError(m);
}return buildGrammar(m,namespace)}function getScriptElementContents(el){if(!isElement(el)){throw new TypeError("Expected a DOM Node, got "+common.unexpectedObjToString(el))}if(el.type!=="text/ohm-js"){throw new Error('Expected a script tag with type="text/ohm-js", got '+el)}return el.getAttribute("src")?load(el.getAttribute("src")):el.innerHTML}function grammar(source,optNamespace){var ns=grammars(source,optNamespace);var grammarNames=Object.keys(ns);if(grammarNames.length===0){throw new Error("Missing grammar definition")}else if(grammarNames.length>1){var secondGrammar=ns[grammarNames[1]];var interval=secondGrammar.definitionInterval;throw new Error(util.getLineAndColumnMessage(interval.inputStream.source,interval.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return ns[grammarNames[0]]}function grammars(source,optNamespace){var ns=Namespace.extend(Namespace.asNamespace(optNamespace));if(typeof source!=="string"){if(Buffer&&Buffer.isBuffer(source)){source=source.toString()}else{throw new TypeError("Expected string as first argument, got "+common.unexpectedObjToString(source))}}compileAndLoad(source,ns);return ns}function grammarFromScriptElement(optNode){var node=optNode;if(isUndefined(node)){var nodeList=documentInterface.querySelectorAll('script[type="text/ohm-js"]');if(nodeList.length!==1){throw new Error('Expected exactly one script tag with type="text/ohm-js", found '+nodeList.length)}node=nodeList[0]}return grammar(getScriptElementContents(node))}function grammarsFromScriptElements(optNodeOrNodeList){if(isElement(optNodeOrNodeList)){return grammars(optNodeOrNodeList)}var nodeList=optNodeOrNodeList;if(isUndefined(nodeList)){nodeList=documentInterface.querySelectorAll('script[type="text/ohm-js"]')}else if(typeof nodeList==="string"||!isElement(nodeList)&&!isArrayLike(nodeList)){throw new TypeError("Expected a Node, NodeList, or Array, but got "+nodeList)}var ns=Namespace.createNamespace();for(var i=0;i<nodeList.length;++i){common.extend(ns,grammars(getScriptElementContents(nodeList[i]),ns))}return ns}function makeRecipe(recipeFn){return recipeFn.call(new Builder)}module.exports={createNamespace:Namespace.createNamespace,error:errors,grammar:grammar,grammars:grammars,grammarFromScriptElement:grammarFromScriptElement,grammarsFromScriptElements:grammarsFromScriptElements,makeRecipe:makeRecipe,util:util};Grammar.BuiltInRules=_dereq_("../dist/built-in-rules");ohmGrammar=_dereq_("../dist/ohm-grammar");module.exports._buildGrammar=buildGrammar;module.exports._setDocumentInterfaceForTesting=function(doc){documentInterface=doc};module.exports.ohmGrammar=ohmGrammar}).call(this,_dereq_("buffer").Buffer)},{"../dist/built-in-rules":1,"../dist/ohm-grammar":2,"./Builder":15,"./Grammar":16,"./Namespace":21,"./common":26,"./errors":27,"./util":44,buffer:3}],29:[function(_dereq_,module,exports){"use strict";var inherits=_dereq_("inherits");function Node(grammar,ctorName,children,interval){this.grammar=grammar;this.ctorName=ctorName;this.children=children;this.interval=interval}Node.prototype.numChildren=function(){return this.children.length};Node.prototype.childAt=function(idx){return this.children[idx]};Node.prototype.indexOfChild=function(arg){return this.children.indexOf(arg)};Node.prototype.hasChildren=function(){return this.children.length>0};Node.prototype.hasNoChildren=function(){return!this.hasChildren()};Node.prototype.onlyChild=function(){if(this.children.length!==1){throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)")}else{return this.firstChild()}};Node.prototype.firstChild=function(){if(this.hasNoChildren()){throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children")}else{return this.childAt(0)}};Node.prototype.lastChild=function(){if(this.hasNoChildren()){throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children")}else{return this.childAt(this.numChildren()-1)}};Node.prototype.childBefore=function(child){var childIdx=this.indexOfChild(child);if(childIdx<0){throw new Error("Node.childBefore() called w/ an argument that is not a child")}else if(childIdx===0){throw new Error("cannot get child before first child")}else{return this.childAt(childIdx-1)}};Node.prototype.childAfter=function(child){var childIdx=this.indexOfChild(child);if(childIdx<0){throw new Error("Node.childAfter() called w/ an argument that is not a child")}else if(childIdx===this.numChildren()-1){throw new Error("cannot get child after last child")}else{return this.childAt(childIdx+1)}};Node.prototype.isTerminal=function(){return false};Node.prototype.toJSON=function(){var r={};r[this.ctorName]=this.children;return r};function TerminalNode(grammar,value,interval){Node.call(this,grammar,"_terminal",[],interval);this.primitiveValue=value}inherits(TerminalNode,Node);TerminalNode.prototype.isTerminal=function(){return true};module.exports={Node:Node,TerminalNode:TerminalNode}},{inherits:12}],30:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var errors=_dereq_("./errors");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.assertAllApplicationsAreValid=common.abstract;pexprs.anything.assertAllApplicationsAreValid=pexprs.end.assertAllApplicationsAreValid=pexprs.Prim.prototype.assertAllApplicationsAreValid=pexprs.Range.prototype.assertAllApplicationsAreValid=pexprs.Param.prototype.assertAllApplicationsAreValid=function(ruleName,grammar){};pexprs.Alt.prototype.assertAllApplicationsAreValid=function(ruleName,grammar){for(var idx=0;idx<this.terms.length;idx++){this.terms[idx].assertAllApplicationsAreValid(ruleName,grammar)}};pexprs.Seq.prototype.assertAllApplicationsAreValid=function(ruleName,grammar){for(var idx=0;idx<this.factors.length;idx++){this.factors[idx].assertAllApplicationsAreValid(ruleName,grammar)}};pexprs.Iter.prototype.assertAllApplicationsAreValid=pexprs.Not.prototype.assertAllApplicationsAreValid=pexprs.Lookahead.prototype.assertAllApplicationsAreValid=pexprs.Lex.prototype.assertAllApplicationsAreValid=pexprs.Arr.prototype.assertAllApplicationsAreValid=pexprs.Str.prototype.assertAllApplicationsAreValid=function(ruleName,grammar){this.expr.assertAllApplicationsAreValid(ruleName,grammar)};pexprs.Obj.prototype.assertAllApplicationsAreValid=function(ruleName,grammar){for(var idx=0;idx<this.properties.length;idx++){this.properties[idx].pattern.assertAllApplicationsAreValid(ruleName,grammar)}};pexprs.Apply.prototype.assertAllApplicationsAreValid=function(ruleName,grammar){var body=grammar.ruleDict[this.ruleName];if(!body){throw new errors.UndeclaredRule(this.ruleName,grammar.name,this)}if(!common.isSyntactic(ruleName)&&common.isSyntactic(this.ruleName)){throw new errors.ApplicationOfSyntacticRuleFromLexicalRule(ruleName,this.ruleName,this)}var actual=this.params.length;var expected=body.formals.length;if(actual!==expected){throw new errors.WrongNumberOfParameters(this.ruleName,expected,actual,this)}var self=this;this.params.forEach(function(param){param.assertAllApplicationsAreValid(ruleName,grammar);if(param.getArity()!==1){throw new errors.InvalidParameter(self.ruleName,param)}})}},{"./common":26,"./errors":27,"./pexprs":43}],31:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var errors=_dereq_("./errors");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.assertChoicesHaveUniformArity=common.abstract;pexprs.anything.assertChoicesHaveUniformArity=pexprs.end.assertChoicesHaveUniformArity=pexprs.Prim.prototype.assertChoicesHaveUniformArity=pexprs.Range.prototype.assertChoicesHaveUniformArity=pexprs.Param.prototype.assertChoicesHaveUniformArity=pexprs.Lex.prototype.assertChoicesHaveUniformArity=function(ruleName){};pexprs.Alt.prototype.assertChoicesHaveUniformArity=function(ruleName){if(this.terms.length===0){return}var arity=this.terms[0].getArity();for(var idx=0;idx<this.terms.length;idx++){var term=this.terms[idx];term.assertChoicesHaveUniformArity();var otherArity=term.getArity();if(arity!==otherArity){throw new errors.InconsistentArity(ruleName,arity,otherArity,this)}}};pexprs.Extend.prototype.assertChoicesHaveUniformArity=function(ruleName){var actualArity=this.terms[0].getArity();var expectedArity=this.terms[1].getArity();if(actualArity!==expectedArity){throw new errors.InconsistentArity(ruleName,expectedArity,actualArity,this)}};pexprs.Seq.prototype.assertChoicesHaveUniformArity=function(ruleName){for(var idx=0;idx<this.factors.length;idx++){this.factors[idx].assertChoicesHaveUniformArity(ruleName)}};pexprs.Iter.prototype.assertChoicesHaveUniformArity=function(ruleName){this.expr.assertChoicesHaveUniformArity(ruleName)};pexprs.Not.prototype.assertChoicesHaveUniformArity=function(ruleName){};pexprs.Lookahead.prototype.assertChoicesHaveUniformArity=pexprs.Arr.prototype.assertChoicesHaveUniformArity=pexprs.Str.prototype.assertChoicesHaveUniformArity=function(ruleName){this.expr.assertChoicesHaveUniformArity(ruleName)};pexprs.Obj.prototype.assertChoicesHaveUniformArity=function(ruleName){for(var idx=0;idx<this.properties.length;idx++){this.properties[idx].pattern.assertChoicesHaveUniformArity(ruleName)}};pexprs.Apply.prototype.assertChoicesHaveUniformArity=function(ruleName){}},{"./common":26,"./errors":27,"./pexprs":43}],32:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var errors=_dereq_("./errors");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.assertIteratedExprsAreNotNullable=common.abstract;pexprs.anything.assertIteratedExprsAreNotNullable=pexprs.end.assertIteratedExprsAreNotNullable=pexprs.Prim.prototype.assertIteratedExprsAreNotNullable=pexprs.Prim.prototype.assertIteratedExprsAreNotNullable=pexprs.Range.prototype.assertIteratedExprsAreNotNullable=pexprs.Param.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){};pexprs.Alt.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){for(var idx=0;idx<this.terms.length;idx++){this.terms[idx].assertIteratedExprsAreNotNullable(grammar,ruleName)}};pexprs.Seq.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){for(var idx=0;idx<this.factors.length;idx++){this.factors[idx].assertIteratedExprsAreNotNullable(grammar,ruleName)}};pexprs.Iter.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){this.expr.assertIteratedExprsAreNotNullable(grammar,ruleName);if(this.expr.isNullable(grammar)){throw new errors.KleeneExprHasNullableOperand(this,ruleName)}};pexprs.Opt.prototype.assertIteratedExprsAreNotNullable=pexprs.Not.prototype.assertIteratedExprsAreNotNullable=pexprs.Lookahead.prototype.assertIteratedExprsAreNotNullable=pexprs.Lex.prototype.assertIteratedExprsAreNotNullable=pexprs.Arr.prototype.assertIteratedExprsAreNotNullable=pexprs.Str.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){this.expr.assertIteratedExprsAreNotNullable(grammar,ruleName)};pexprs.Obj.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){for(var idx=0;idx<this.properties.length;idx++){this.properties[idx].pattern.assertIteratedExprsAreNotNullable(grammar,ruleName)}};pexprs.Apply.prototype.assertIteratedExprsAreNotNullable=function(grammar,ruleName){this.params.forEach(function(param){param.assertIteratedExprsAreNotNullable(grammar,ruleName)})}},{"./common":26,"./errors":27,"./pexprs":43}],33:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var nodes=_dereq_("./nodes");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.check=common.abstract;pexprs.anything.check=function(grammar,vals){return vals.length>=1};pexprs.end.check=function(grammar,vals){return vals[0]instanceof nodes.Node&&vals[0].isTerminal()&&vals[0].primitiveValue===undefined};pexprs.Prim.prototype.check=function(grammar,vals){return vals[0]instanceof nodes.Node&&vals[0].isTerminal()&&vals[0].primitiveValue===this.obj};pexprs.Range.prototype.check=function(grammar,vals){return vals[0]instanceof nodes.Node&&vals[0].isTerminal()&&typeof vals[0].primitiveValue===typeof this.from};pexprs.Param.prototype.check=function(grammar,vals){return vals.length>=1};pexprs.Alt.prototype.check=function(grammar,vals){for(var i=0;i<this.terms.length;i++){var term=this.terms[i];if(term.check(grammar,vals)){return true}}return false};pexprs.Seq.prototype.check=function(grammar,vals){var pos=0;for(var i=0;i<this.factors.length;i++){var factor=this.factors[i];if(factor.check(grammar,vals.slice(pos))){pos+=factor.getArity()}else{return false}}return true};pexprs.Iter.prototype.check=function(grammar,vals){var arity=this.getArity();var columns=vals.slice(0,arity);if(columns.length!==arity){return false}var rowCount=columns[0].length;var i;for(i=1;i<arity;i++){if(columns[i].length!==rowCount){return false}}for(i=0;i<rowCount;i++){var row=[];for(var j=0;j<arity;j++){row.push(columns[j][i])}if(!this.expr.check(grammar,row)){return false}}return true};pexprs.Not.prototype.check=function(grammar,vals){return true};pexprs.Lookahead.prototype.check=pexprs.Lex.prototype.check=pexprs.Arr.prototype.check=pexprs.Str.prototype.check=function(grammar,vals){return this.expr.check(grammar,vals)};pexprs.Obj.prototype.check=function(grammar,vals){var fixedArity=this.getArity();if(this.isLenient){fixedArity--}var pos=0;for(var i=0;i<fixedArity;i++){var pattern=this.properties[i].pattern;if(pattern.check(grammar,vals.slice(pos))){pos+=pattern.getArity()}else{return false}}return this.isLenient?typeof vals[pos]==="object"&&vals[pos]:true};pexprs.Apply.prototype.check=function(grammar,vals){if(!(vals[0]instanceof nodes.Node&&vals[0].grammar===grammar&&vals[0].ctorName===this.ruleName)){return false}var ruleNode=vals[0];var body=grammar.ruleDict[this.ruleName];return body.check(grammar,ruleNode.children)&&ruleNode.numChildren()===body.getArity()}},{"./common":26,"./nodes":29,"./pexprs":43}],34:[function(_dereq_,module,exports){"use strict";var InputStream=_dereq_("./InputStream");var common=_dereq_("./common");var nodes=_dereq_("./nodes");var pexprs=_dereq_("./pexprs");var Node=nodes.Node;var TerminalNode=nodes.TerminalNode;pexprs.PExpr.prototype.eval=function(state){var inputStream=state.inputStream;var origPos=inputStream.pos;var origNumBindings=state.bindings.length;var origTrace=state.trace;if(state.isTracing()){state.trace=[]}var ans=this._eval(state);if(state.isTracing()){var traceEntry=state.getTraceEntry(origPos,this,ans);origTrace.push(traceEntry);state.trace=origTrace}if(!ans){inputStream.pos=origPos;state.truncateBindings(origNumBindings)}return ans};pexprs.PExpr.prototype._eval=common.abstract;pexprs.anything._eval=function(state){var origPos=state.skipSpacesIfInSyntacticContext();var inputStream=state.inputStream;var value=inputStream.next();if(value===common.fail){state.recordFailure(origPos,this);return false}else{var interval=inputStream.interval(origPos);state.bindings.push(new TerminalNode(state.grammar,value,interval));return true}};pexprs.end._eval=function(state){var origPos=state.skipSpacesIfInSyntacticContext();var inputStream=state.inputStream;if(inputStream.atEnd()){var interval=inputStream.interval(inputStream.pos);state.bindings.push(new TerminalNode(state.grammar,undefined,interval));return true}else{state.recordFailure(origPos,this);return false}};pexprs.Prim.prototype._eval=function(state){var origPos=state.skipSpacesIfInSyntacticContext();var inputStream=state.inputStream;if(this.match(inputStream)===common.fail){state.recordFailure(origPos,this);return false}else{var interval=inputStream.interval(origPos);var primitiveValue=this.obj;state.bindings.push(new TerminalNode(state.grammar,primitiveValue,interval));return true}};pexprs.Prim.prototype.match=function(inputStream){return inputStream.matchExactly(this.obj)};pexprs.StringPrim.prototype.match=function(inputStream){return inputStream.matchString(this.obj)};pexprs.Range.prototype._eval=function(state){var origPos=state.skipSpacesIfInSyntacticContext();var inputStream=state.inputStream;var obj=inputStream.next();if(typeof obj===typeof this.from&&this.from<=obj&&obj<=this.to){var interval=inputStream.interval(origPos);state.bindings.push(new TerminalNode(state.grammar,obj,interval));return true}else{state.recordFailure(origPos,this);return false}};pexprs.Param.prototype._eval=function(state,inputStream){return state.currentApplication().params[this.index].eval(state)};pexprs.Alt.prototype._eval=function(state){for(var idx=0;idx<this.terms.length;idx++){if(this.terms[idx].eval(state)){return true}}return false};pexprs.Seq.prototype._eval=function(state){for(var idx=0;idx<this.factors.length;idx++){var factor=this.factors[idx];if(!factor.eval(state)){return false}}return true};pexprs.Iter.prototype._eval=function(state){var inputStream=state.inputStream;var origPos=inputStream.pos;var arity=this.getArity();var cols=[];while(cols.length<arity){cols.push([])}var numMatches=0;var idx;while(numMatches<this.maxNumMatches&&this.expr.eval(state)){numMatches++;var row=state.bindings.splice(state.bindings.length-arity,arity);for(idx=0;idx<row.length;idx++){cols[idx].push(row[idx])}}if(numMatches<this.minNumMatches){return false}var interval;if(numMatches===0){interval=inputStream.interval(origPos,origPos)}else{var firstCol=cols[0];var lastCol=cols[cols.length-1];interval=inputStream.interval(firstCol[0].interval.startIdx,lastCol[lastCol.length-1].interval.endIdx)}for(idx=0;idx<cols.length;idx++){state.bindings.push(new Node(state.grammar,"_iter",cols[idx],interval))}return true};pexprs.Not.prototype._eval=function(state){var inputStream=state.inputStream;var origPos=inputStream.pos;var origNumBindings=state.bindings.length;state.ignoreFailures();var ans=this.expr.eval(state);state.recordFailures();if(ans){state.recordFailure(origPos,this);state.truncateBindings(origNumBindings);return false}else{inputStream.pos=origPos;return true}};pexprs.Lookahead.prototype._eval=function(state){var inputStream=state.inputStream;var origPos=inputStream.pos;if(this.expr.eval(state)){inputStream.pos=origPos;return true}else{return false}};pexprs.Lex.prototype._eval=function(state){var app=state.currentApplication();app.lexify();var ans=this.expr.eval(state);app.unlexify();return ans};pexprs.Arr.prototype._eval=function(state){var obj=state.inputStream.next();if(Array.isArray(obj)){var objInputStream=InputStream.newFor(obj);state.pushInputStream(objInputStream);var ans=this.expr.eval(state)&&objInputStream.atEnd();state.popInputStream();return ans}else{return false}};pexprs.Str.prototype._eval=function(state){var obj=state.inputStream.next();if(typeof obj==="string"){var strInputStream=InputStream.newFor(obj);state.pushInputStream(strInputStream);var ans=this.expr.eval(state)&&pexprs.end.eval(state);if(ans){state.bindings.pop()}state.popInputStream();return ans}else{return false}};pexprs.Obj.prototype._eval=function(state){var inputStream=state.inputStream;var origPos=inputStream.pos;var obj=inputStream.next();if(obj!==common.fail&&obj&&(typeof obj==="object"||typeof obj==="function")){var numOwnPropertiesMatched=0;for(var idx=0;idx<this.properties.length;idx++){var property=this.properties[idx];if(!obj.hasOwnProperty(property.name)){return false}var value=obj[property.name];var valueInputStream=InputStream.newFor([value]);state.pushInputStream(valueInputStream);var matched=property.pattern.eval(state)&&valueInputStream.atEnd();state.popInputStream();if(!matched){return false}numOwnPropertiesMatched++}if(this.isLenient){var remainder={};for(var p in obj){if(obj.hasOwnProperty(p)&&this.properties.indexOf(p)<0){remainder[p]=obj[p]}}var interval=inputStream.interval(origPos);state.bindings.push(new TerminalNode(state.grammar,remainder,interval));return true}else{return numOwnPropertiesMatched===Object.keys(obj).length}}else{return false}};function useMemoizedResult(state,application,memoRecOrLR){var inputStream=state.inputStream;var bindings=state.bindings;inputStream.pos=memoRecOrLR.pos;if(memoRecOrLR.failureDescriptor){state.recordFailures(memoRecOrLR.failureDescriptor,application)}if(state.isTracing()){state.trace.push(memoRecOrLR.traceEntry)}if(memoRecOrLR.value){bindings.push(memoRecOrLR.value);return true}return false}pexprs.Apply.prototype._eval=function(state){var inputStream=state.inputStream;var grammar=state.grammar;var bindings=state.bindings;var caller=state.currentApplication();var actuals=caller?caller.params:[];var app=this.substituteParams(actuals);var ruleName=app.ruleName;var memoKey=app.toMemoKey();if(this!==state.applySpaces_&&(caller&&caller.isSyntactic()||app.isSyntactic())){state.skipSpaces()}var origPos=inputStream.pos;var origPosInfo=state.getCurrentPosInfo();var memoRec=origPosInfo.memo[memoKey];var currentLR;if(memoRec&&origPosInfo.shouldUseMemoizedResult(this,memoRec)){return useMemoizedResult(state,this,memoRec)}else if(origPosInfo.isActive(app)){currentLR=origPosInfo.getCurrentLeftRecursion();if(currentLR&&currentLR.memoKey===memoKey){origPosInfo.updateInvolvedApplications();return useMemoizedResult(state,this,currentLR)}else{origPosInfo.startLeftRecursion(app);return false}}else{var body=grammar.ruleDict[ruleName];origPosInfo.enter(app);if(body.description){state.ignoreFailures()}var value=app.evalOnce(body,state);currentLR=origPosInfo.getCurrentLeftRecursion();if(currentLR){if(currentLR.memoKey===memoKey){value=app.handleLeftRecursion(body,state,origPos,currentLR,value);origPosInfo.memo[memoKey]={pos:inputStream.pos,value:value,involvedApplications:currentLR.involvedApplications};origPosInfo.endLeftRecursion(app)}else if(!currentLR.involvedApplications[memoKey]){origPosInfo.memo[memoKey]={pos:inputStream.pos,value:value}}}else{origPosInfo.memo[memoKey]={pos:inputStream.pos,value:value}}if(body.description){state.recordFailures();if(!value){state.recordFailure(origPos,app)}}if(state.isTracing()&&origPosInfo.memo[memoKey]){var entry=state.getTraceEntry(origPos,app,value);entry.setLeftRecursive(currentLR&&currentLR.memoKey===memoKey);origPosInfo.memo[memoKey].traceEntry=entry}var ans;if(value){bindings.push(value);if(!caller){if(app.isSyntactic()){state.skipSpaces()}ans=pexprs.end.eval(state);bindings.pop()}else{ans=true}}else{ans=false}origPosInfo.exit();return ans}};pexprs.Apply.prototype.evalOnce=function(expr,state){var inputStream=state.inputStream;var origPos=inputStream.pos;if(expr.eval(state)){var arity=expr.getArity();var bindings=state.bindings.splice(state.bindings.length-arity,arity);var ans=new Node(state.grammar,this.ruleName,bindings,inputStream.interval(origPos));return ans}else{return false}};pexprs.Apply.prototype.handleLeftRecursion=function(body,state,origPos,currentLR,seedValue){if(!seedValue){return seedValue}var inputStream=state.inputStream;var value=seedValue;currentLR.value=seedValue;currentLR.pos=inputStream.pos;while(true){if(state.isTracing()){currentLR.traceEntry=common.clone(state.trace[state.trace.length-1])}inputStream.pos=origPos;value=this.evalOnce(body,state);if(value&&inputStream.pos>currentLR.pos){currentLR.value=value;currentLR.pos=inputStream.pos}else{inputStream.pos=currentLR.pos;if(state.isTracing()){state.trace.pop()}break}}return currentLR.value}},{"./InputStream":18,"./common":26,"./nodes":29,"./pexprs":43}],35:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.getArity=common.abstract;pexprs.anything.getArity=pexprs.end.getArity=pexprs.Prim.prototype.getArity=pexprs.Range.prototype.getArity=pexprs.Param.prototype.getArity=pexprs.Apply.prototype.getArity=function(){return 1};pexprs.Alt.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()};pexprs.Seq.prototype.getArity=function(){var arity=0;for(var idx=0;idx<this.factors.length;idx++){arity+=this.factors[idx].getArity()}return arity};pexprs.Iter.prototype.getArity=function(){return this.expr.getArity()};pexprs.Not.prototype.getArity=function(){return 0};pexprs.Lookahead.prototype.getArity=pexprs.Lex.prototype.getArity=pexprs.Arr.prototype.getArity=pexprs.Str.prototype.getArity=function(){return this.expr.getArity()};pexprs.Obj.prototype.getArity=function(){var arity=this.isLenient?1:0;for(var idx=0;idx<this.properties.length;idx++){arity+=this.properties[idx].pattern.getArity()}return arity}},{"./common":26,"./pexprs":43}],36:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.introduceParams=common.abstract;pexprs.anything.introduceParams=pexprs.end.introduceParams=pexprs.Prim.prototype.introduceParams=pexprs.Range.prototype.introduceParams=pexprs.Param.prototype.introduceParams=function(formals){return this};pexprs.Alt.prototype.introduceParams=function(formals){this.terms.forEach(function(term,idx,terms){terms[idx]=term.introduceParams(formals)});return this};pexprs.Seq.prototype.introduceParams=function(formals){this.factors.forEach(function(factor,idx,factors){factors[idx]=factor.introduceParams(formals)});return this};pexprs.Iter.prototype.introduceParams=pexprs.Not.prototype.introduceParams=pexprs.Lookahead.prototype.introduceParams=pexprs.Lex.prototype.introduceParams=pexprs.Arr.prototype.introduceParams=pexprs.Str.prototype.introduceParams=function(formals){this.expr=this.expr.introduceParams(formals);return this};pexprs.Obj.prototype.introduceParams=function(formals){this.properties.forEach(function(property,idx){property.pattern=property.pattern.introduceParams(formals)});return this};pexprs.Apply.prototype.introduceParams=function(formals){var index=formals.indexOf(this.ruleName);if(index>=0){if(this.params.length>0){throw new Error("FIXME: should catch this earlier")}return new pexprs.Param(index)}else{this.params.forEach(function(param,idx,params){params[idx]=param.introduceParams(formals)});return this}}},{"./common":26,"./pexprs":43}],37:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.isNullable=function(grammar){return this._isNullable(grammar,Object.create(null))};pexprs.PExpr.prototype._isNullable=common.abstract;pexprs.anything._isNullable=pexprs.Prim.prototype._isNullable=pexprs.Range.prototype._isNullable=pexprs.Param.prototype._isNullable=pexprs.Plus.prototype._isNullable=pexprs.Arr.prototype._isNullable=pexprs.Obj.prototype._isNullable=function(grammar,memo){return false};pexprs.end._isNullable=function(grammar,memo){return true};pexprs.StringPrim.prototype._isNullable=function(grammar,memo){return this.obj===""};pexprs.Alt.prototype._isNullable=function(grammar,memo){return this.terms.length===0||this.terms.some(function(term){return term._isNullable(grammar,memo)})};pexprs.Seq.prototype._isNullable=function(grammar,memo){return this.factors.every(function(factor){return factor._isNullable(grammar,memo)})};pexprs.Star.prototype._isNullable=pexprs.Opt.prototype._isNullable=pexprs.Not.prototype._isNullable=pexprs.Lookahead.prototype._isNullable=function(grammar,memo){return true};pexprs.Lex.prototype._isNullable=function(grammar,memo){return this.expr._isNullable(grammar,memo)};pexprs.Str.prototype._isNullable=function(grammar,memo){return this.expr._isNullable(grammar,memo)};pexprs.Apply.prototype._isNullable=function(grammar,memo){var key=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(memo,key)){var body=grammar.ruleDict[this.ruleName];var inlined=body.substituteParams(this.params);memo[key]=false;memo[key]=inlined._isNullable(grammar,memo)}return memo[key]}},{"./common":26,"./pexprs":43}],38:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.outputRecipe=common.abstract;pexprs.anything.outputRecipe=function(sb,formals){sb.append("this.anything()")};pexprs.end.outputRecipe=function(sb,formals){sb.append("this.end()")};pexprs.Prim.prototype.outputRecipe=function(sb,formals){sb.append("this.prim(");sb.append(typeof this.obj==="string"?JSON.stringify(this.obj):""+this.obj);sb.append(")")};pexprs.Range.prototype.outputRecipe=function(sb,formals){sb.append("this.range(");sb.append(JSON.stringify(this.from));sb.append(", ");sb.append(JSON.stringify(this.to));sb.append(")")};pexprs.Param.prototype.outputRecipe=function(sb,formals){sb.append("this.param("+this.index+")")};pexprs.Alt.prototype.outputRecipe=function(sb,formals){sb.append("this.alt(");for(var idx=0;idx<this.terms.length;idx++){if(idx>0){sb.append(", ")}this.terms[idx].outputRecipe(sb,formals)}sb.append(")")};pexprs.Seq.prototype.outputRecipe=function(sb,formals){sb.append("this.seq(");for(var idx=0;idx<this.factors.length;idx++){if(idx>0){sb.append(", ")}this.factors[idx].outputRecipe(sb,formals)}sb.append(")")};pexprs.Star.prototype.outputRecipe=function(sb,formals){sb.append("this.star(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Plus.prototype.outputRecipe=function(sb,formals){sb.append("this.plus(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Opt.prototype.outputRecipe=function(sb,formals){sb.append("this.opt(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Not.prototype.outputRecipe=function(sb,formals){sb.append("this.not(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Lookahead.prototype.outputRecipe=function(sb,formals){sb.append("this.la(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Lex.prototype.outputRecipe=function(sb,formals){sb.append("this.lex(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Arr.prototype.outputRecipe=function(sb,formals){sb.append("this.arr(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Str.prototype.outputRecipe=function(sb,formals){sb.append("this.str(");this.expr.outputRecipe(sb,formals);sb.append(")")};pexprs.Obj.prototype.outputRecipe=function(sb,formals){function outputPropertyRecipe(prop){sb.append("{name: ");sb.append(JSON.stringify(prop.name));sb.append(", pattern: ");prop.pattern.outputRecipe(sb,formals);sb.append("}")}sb.append("this.obj([");for(var idx=0;idx<this.properties.length;idx++){if(idx>0){sb.append(", ")}outputPropertyRecipe(this.properties[idx])}sb.append("], ");sb.append(!!this.isLenient);sb.append(")")};pexprs.Apply.prototype.outputRecipe=function(sb,formals){sb.append("this.app(");sb.append(JSON.stringify(this.ruleName));if(this.ruleName.indexOf("_")>=0&&formals.length>0){var apps=formals.map(function(formal){return"this.app("+JSON.stringify(formal)+")"});sb.append(", ["+apps.join(", ")+"]")}else if(this.params.length>0){sb.append(", [");this.params.forEach(function(param,idx){if(idx>0){sb.append(", ")}param.outputRecipe(sb,formals)});sb.append("]")}sb.append(")")}},{"./common":26,"./pexprs":43}],39:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.substituteParams=common.abstract;pexprs.anything.substituteParams=pexprs.end.substituteParams=pexprs.Prim.prototype.substituteParams=pexprs.Range.prototype.substituteParams=pexprs.Prim.prototype.substituteParams=function(actuals){return this};pexprs.Param.prototype.substituteParams=function(actuals){return actuals[this.index]};pexprs.Alt.prototype.substituteParams=function(actuals){return new pexprs.Alt(this.terms.map(function(term){return term.substituteParams(actuals)}))};pexprs.Seq.prototype.substituteParams=function(actuals){return new pexprs.Seq(this.factors.map(function(factor){return factor.substituteParams(actuals)}))};pexprs.Iter.prototype.substituteParams=pexprs.Not.prototype.substituteParams=pexprs.Lookahead.prototype.substituteParams=pexprs.Lex.prototype.substituteParams=pexprs.Arr.prototype.substituteParams=pexprs.Str.prototype.substituteParams=function(actuals){return new this.constructor(this.expr.substituteParams(actuals))};pexprs.Obj.prototype.substituteParams=function(actuals){var properties=this.properties.map(function(property){return{name:property.name,pattern:property.pattern.substituteParams(actuals)}});return new pexprs.Obj(properties,this.isLenient)};pexprs.Apply.prototype.substituteParams=function(actuals){
if(this.params.length===0){return this}else{var params=this.params.map(function(param){return param.substituteParams(actuals)});return new pexprs.Apply(this.ruleName,params)}}},{"./common":26,"./pexprs":43}],40:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.toDisplayString=common.abstract;pexprs.Alt.prototype.toDisplayString=pexprs.Seq.prototype.toDisplayString=pexprs.Iter.prototype.toDisplayString=pexprs.Not.prototype.toDisplayString=pexprs.Lookahead.prototype.toDisplayString=pexprs.Lex.prototype.toDisplayString=pexprs.Arr.prototype.toDisplayString=pexprs.Str.prototype.toDisplayString=pexprs.Obj.prototype.toDisplayString=function(){if(this.interval){return this.interval.trimmed().contents}return"["+this.constructor.name+"]"};pexprs.anything.toDisplayString=function(){return"_"};pexprs.end.toDisplayString=function(){return"end"};pexprs.Prim.prototype.toDisplayString=function(){return String(this.obj)};pexprs.StringPrim.prototype.toDisplayString=function(){return'"'+this.obj+'"'};pexprs.Range.prototype.toDisplayString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)};pexprs.Param.prototype.toDisplayString=function(){return"#"+this.index};pexprs.Apply.prototype.toDisplayString=function(){return this.ruleName}},{"./common":26,"./pexprs":43}],41:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.toExpected=common.abstract;pexprs.anything.toExpected=function(ruleDict){return"any object"};pexprs.end.toExpected=function(ruleDict){return"end of input"};pexprs.Prim.prototype.toExpected=function(ruleDict){return JSON.stringify(this.obj)};pexprs.Range.prototype.toExpected=function(ruleDict){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)};pexprs.Not.prototype.toExpected=function(ruleDict){if(this.expr===pexprs.anything){return"nothing"}else{return"not "+this.expr.toExpected(ruleDict)}};pexprs.Apply.prototype.toExpected=function(ruleDict){var description=ruleDict[this.ruleName].description;if(description){return description}else{var article=/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a";return article+" "+this.ruleName}}},{"./common":26,"./pexprs":43}],42:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var pexprs=_dereq_("./pexprs");pexprs.PExpr.prototype.toString=common.abstract;pexprs.anything.toString=function(){return"_"};pexprs.end.toString=function(){return"end"};pexprs.Prim.prototype.toString=function(){return JSON.stringify(this.obj)};pexprs.Range.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)};pexprs.Param.prototype.toString=function(){return"$"+this.index};pexprs.Lex.prototype.toString=function(){return"#("+this.expr.toString()+")"};pexprs.Alt.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(function(term){return term.toString()}).join(" | ")+")"};pexprs.Seq.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(function(factor){return factor.toString()}).join(" ")+")"};pexprs.Iter.prototype.toString=function(){return this.expr+this.operator};pexprs.Not.prototype.toString=function(){return"~"+this.expr};pexprs.Lookahead.prototype.toString=function(){return"&"+this.expr};pexprs.Arr.prototype.toString=function(){return"["+this.expr.toString()+"]"};pexprs.Str.prototype.toString=function(){return"``"+this.expr.toString()+"''"};pexprs.Obj.prototype.toString=function(){var parts=["{"];var first=true;function emit(part){if(first){first=false}else{parts.push(", ")}parts.push(part)}this.properties.forEach(function(property){emit(JSON.stringify(property.name)+": "+property.pattern.toString())});if(this.isLenient){emit("...")}parts.push("}");return parts.join("")};pexprs.Apply.prototype.toString=function(){if(this.params.length>0){var ps=this.params.map(function(param){return param.toString()});return this.ruleName+"<"+ps.join(",")+">"}else{return this.ruleName}}},{"./common":26,"./pexprs":43}],43:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");var errors=_dereq_("./errors");var inherits=_dereq_("inherits");function PExpr(){throw new Error("PExpr cannot be instantiated -- it's abstract")}PExpr.prototype.withDescription=function(description){this.description=description;return this};PExpr.prototype.withInterval=function(interval){this.interval=interval.trimmed();return this};PExpr.prototype.withFormals=function(formals){this.formals=formals;return this};var anything=Object.create(PExpr.prototype);var end=Object.create(PExpr.prototype);function Prim(obj){this.obj=obj}inherits(Prim,PExpr);function StringPrim(obj){this.obj=obj}inherits(StringPrim,Prim);function Range(from,to){this.from=from;this.to=to}inherits(Range,PExpr);function Param(index){this.index=index}inherits(Param,PExpr);function Alt(terms){this.terms=terms}inherits(Alt,PExpr);function Extend(superGrammar,name,body){var origBody=superGrammar.ruleDict[name];this.terms=[body,origBody]}inherits(Extend,Alt);function Seq(factors){this.factors=factors}inherits(Seq,PExpr);function Iter(expr){this.expr=expr}inherits(Iter,PExpr);function Star(expr){this.expr=expr}inherits(Star,Iter);function Plus(expr){this.expr=expr}inherits(Plus,Iter);function Opt(expr){this.expr=expr}inherits(Opt,Iter);Star.prototype.operator="*";Plus.prototype.operator="+";Opt.prototype.operator="?";Star.prototype.minNumMatches=0;Plus.prototype.minNumMatches=1;Opt.prototype.minNumMatches=0;Star.prototype.maxNumMatches=Number.POSITIVE_INFINITY;Plus.prototype.maxNumMatches=Number.POSITIVE_INFINITY;Opt.prototype.maxNumMatches=1;function Not(expr){this.expr=expr}inherits(Not,PExpr);function Lookahead(expr){this.expr=expr}inherits(Lookahead,PExpr);function Lex(expr){this.expr=expr}inherits(Lex,PExpr);function Arr(expr){this.expr=expr}inherits(Arr,PExpr);function Str(expr){this.expr=expr}inherits(Str,PExpr);function Obj(properties,isLenient){var names=properties.map(function(property){return property.name});var duplicates=common.getDuplicates(names);if(duplicates.length>0){throw new errors.DuplicatePropertyNames(duplicates)}else{this.properties=properties;this.isLenient=isLenient}}inherits(Obj,PExpr);function Apply(ruleName,optParams){this.ruleName=ruleName;this.params=optParams||[];this.lexifyCount=0}inherits(Apply,PExpr);Apply.prototype.lexify=function(){this.lexifyCount++};Apply.prototype.unlexify=function(){this.lexifyCount--};Apply.prototype.isSyntactic=function(){return this.lexifyCount===0&&common.isSyntactic(this.ruleName)};Apply.prototype.toMemoKey=function(){if(!this._memoKey){Object.defineProperty(this,"_memoKey",{value:this.toString()})}return this._memoKey};exports.makePrim=function(obj){if(typeof obj==="string"&&obj.length!==1){return new StringPrim(obj)}else{return new Prim(obj)}};exports.PExpr=PExpr;exports.anything=anything;exports.end=end;exports.Prim=Prim;exports.StringPrim=StringPrim;exports.Range=Range;exports.Param=Param;exports.Alt=Alt;exports.Extend=Extend;exports.Seq=Seq;exports.Iter=Iter;exports.Star=Star;exports.Plus=Plus;exports.Opt=Opt;exports.Not=Not;exports.Lookahead=Lookahead;exports.Lex=Lex;exports.Arr=Arr;exports.Str=Str;exports.Obj=Obj;exports.Apply=Apply;_dereq_("./pexprs-assertAllApplicationsAreValid");_dereq_("./pexprs-assertChoicesHaveUniformArity");_dereq_("./pexprs-assertIteratedExprsAreNotNullable");_dereq_("./pexprs-check");_dereq_("./pexprs-eval");_dereq_("./pexprs-getArity");_dereq_("./pexprs-outputRecipe");_dereq_("./pexprs-introduceParams");_dereq_("./pexprs-isNullable");_dereq_("./pexprs-substituteParams");_dereq_("./pexprs-toDisplayString");_dereq_("./pexprs-toExpected");_dereq_("./pexprs-toString")},{"./common":26,"./errors":27,"./pexprs-assertAllApplicationsAreValid":30,"./pexprs-assertChoicesHaveUniformArity":31,"./pexprs-assertIteratedExprsAreNotNullable":32,"./pexprs-check":33,"./pexprs-eval":34,"./pexprs-getArity":35,"./pexprs-introduceParams":36,"./pexprs-isNullable":37,"./pexprs-outputRecipe":38,"./pexprs-substituteParams":39,"./pexprs-toDisplayString":40,"./pexprs-toExpected":41,"./pexprs-toString":42,inherits:12}],44:[function(_dereq_,module,exports){"use strict";var common=_dereq_("./common");function padNumbersToEqualLength(arr){var maxLen=0;var strings=arr.map(function(n){var str=n.toString();maxLen=Math.max(maxLen,str.length);return str});return strings.map(function(s){return common.padLeft(s,maxLen)})}function strcpy(dest,src,offset){var origDestLen=dest.length;var start=dest.slice(0,offset);var end=dest.slice(offset+src.length);return(start+src+end).substr(0,origDestLen)}exports.getLineAndColumn=function(str,offset){var lineNum=1;var colNum=1;var currOffset=0;var lineStartOffset=0;var nextLine=null;var prevLine=null;var prevLineStartOffset=-1;while(currOffset<offset){var c=str.charAt(currOffset++);if(c==="\n"){lineNum++;colNum=1;prevLineStartOffset=lineStartOffset;lineStartOffset=currOffset}else if(c!=="\r"){colNum++}}var lineEndOffset=str.indexOf("\n",lineStartOffset);if(lineEndOffset===-1){lineEndOffset=str.length}else{var nextLineEndOffset=str.indexOf("\n",lineEndOffset+1);nextLine=nextLineEndOffset===-1?str.slice(lineEndOffset):str.slice(lineEndOffset,nextLineEndOffset);nextLine=nextLine.replace(/^\r?\n/,"").replace(/\r$/,"")}if(prevLineStartOffset>=0){prevLine=str.slice(prevLineStartOffset,lineStartOffset).replace(/\r?\n$/,"")}var line=str.slice(lineStartOffset,lineEndOffset).replace(/\r$/,"");return{lineNum:lineNum,colNum:colNum,line:line,prevLine:prevLine,nextLine:nextLine}};exports.getLineAndColumnMessage=function(str,offset){var repeatStr=common.repeatStr;var lineAndCol=exports.getLineAndColumn(str,offset);var sb=new common.StringBuffer;sb.append("Line "+lineAndCol.lineNum+", col "+lineAndCol.colNum+":\n");var lineNumbers=padNumbersToEqualLength([lineAndCol.prevLine==null?0:lineAndCol.lineNum-1,lineAndCol.lineNum,lineAndCol.nextLine==null?0:lineAndCol.lineNum+1]);function appendLine(num,content,prefix){sb.append(prefix+lineNumbers[num]+" | "+content+"\n")}if(lineAndCol.prevLine!=null){appendLine(0,lineAndCol.prevLine,"  ")}appendLine(1,lineAndCol.line,"> ");var lineLen=lineAndCol.line.length;var indicationLine=repeatStr(" ",lineLen+1);var ranges=Array.prototype.slice.call(arguments,2);for(var i=0;i<ranges.length;++i){var startIdx=ranges[i][0];var endIdx=ranges[i][1];common.assert(startIdx>=0&&startIdx<=endIdx,"range start must be >= 0 and <= end");var lineStartOffset=offset-lineAndCol.colNum+1;startIdx=Math.max(0,startIdx-lineStartOffset);endIdx=Math.min(endIdx-lineStartOffset,lineLen);indicationLine=strcpy(indicationLine,repeatStr("~",endIdx-startIdx),startIdx)}var gutterWidth=2+lineNumbers[1].length+3;sb.append(repeatStr(" ",gutterWidth));indicationLine=strcpy(indicationLine,"^",lineAndCol.colNum-1);sb.append(indicationLine.replace(/ +$/,"")+"\n");if(lineAndCol.nextLine!=null){appendLine(2,lineAndCol.nextLine,"  ")}return sb.contents()}},{"./common":26}]},{},[28])(28)});
